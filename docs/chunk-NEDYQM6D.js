import{$ as _n,$a as ft,A as v,Aa as ns,B as ut,Ba as Te,C as ce,Ca as Ze,D as Fe,Da as ci,E as ne,Ea as Dt,F as d,Fa as is,G as f,Ga as rs,H as m,Ha as yn,I as Hr,Ia as ss,J as Ur,Ja as Vt,K as N,Ka as Xe,L as y,La as os,M as _,Ma as as,N as fn,Na as ls,O as mn,Oa as cs,P,Pa as ds,Q as pe,Qa as us,R as ae,Ra as hs,S as Wr,Sa as di,T as j,U as ie,Ua as me,V as L,Va as Ve,W as A,Wa as re,Xa as je,Y as Z,Ya as pt,Z as fe,Za as Ge,_ as zr,_a as W,a as Re,aa as X,ab as ps,b as ct,ba as qr,bb as fs,cb as mt,d as S,db as _t,e as z,eb as wn,f as ai,fb as xn,gb as bn,h as q,ha as gn,hb as Be,ia as Yr,j as Y,ja as De,k as V,ka as Kr,kb as Je,lb as _e,m as hn,ma as C,na as ht,nb as ge,o as x,oa as $r,ob as Ce,p as b,pa as Qr,pb as ve,q as T,qa as Zr,r as ee,ra as Xr,s as dt,sa as Cn,ta as Jr,u as pn,ua as li,v as g,va as es,w as M,wa as Me,xa as vn,ya as $,z as E,za as ts}from"./chunk-7A4R246M.js";var se=(()=>{let e=class e{constructor(){this.notificationAdded=new z}push(n){this.notificationAdded.next(n)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Sa=i=>({background:i});function ka(i,e){if(i&1&&(d(0,"div",3),P(1),f()),i&2){let t=e.$implicit;ce(ie(3,Sa,t.success?"aquamarine":"lightcoral")),g(),pe(t.message)}}var ms=(()=>{let e=class e{constructor(n){this.notificationsService=n,this.notifications=[],this.timeout=1500}ngOnInit(){this.notificationsService.notificationAdded.subscribe(n=>this.handleNotification(n))}handleNotification(n){this.notifications.push(n),this.clearNext()}clearNext(){setTimeout(()=>this.notifications.splice(0,1),this.timeout)}};e.\u0275fac=function(r){return new(r||e)(M(se))},e.\u0275cmp=V({type:e,selectors:[["app-notifications"]],standalone:!0,features:[j],decls:3,vars:1,consts:[[1,"container"],[1,"bubble-container"],["class","bubble",3,"style",4,"ngFor","ngForOf"],[1,"bubble"]],template:function(r,s){r&1&&(d(0,"div",0)(1,"div",1),E(2,ka,2,5,"div",2),f()()),r&2&&(g(2),v("ngForOf",s.notifications))},dependencies:[X,Z],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.container[_ngcontent-%COMP%]{position:absolute;z-index:12;top:0;left:0;width:100%;display:flex;flex-direction:row;justify-content:center}.bubble-container[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse;justify-content:center;margin-top:.5rem;gap:.5rem}.bubble[_ngcontent-%COMP%]{border-radius:16px;width:fit-content;padding:.25rem 1rem;box-shadow:0 1px 3px gray;margin:auto;font-size:20px}"]});let i=e;return i})();var Ma=["*"],gt=(()=>{let e=class e{constructor(){this.close=new dt}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=V({type:e,selectors:[["app-modal"]],outputs:{close:"close"},standalone:!0,features:[j],ngContentSelectors:Ma,decls:3,vars:0,consts:[[1,"background",3,"click"],[1,"content",3,"click"]],template:function(r,s){r&1&&(fn(),d(0,"div",0),y("click",function(){return s.close.emit()}),d(1,"div",1),y("click",function(a){return a.stopPropagation()}),mn(2),f()())},styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.background[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100vw;height:100vh;background:#80808080;z-index:10;display:flex;flex-direction:column;justify-content:center}.content[_ngcontent-%COMP%]{width:75%;height:80%;max-width:700px;z-index:11;display:flex;flex-direction:column;justify-content:space-between;text-align:center;background:#dedede;margin:auto;font-size:24px;box-shadow:0 1px 2px gray;border-radius:10px;padding:1rem}@media screen and (max-width: 500px),screen and (max-height: 800px){.content[_ngcontent-%COMP%]{width:85%;height:calc(100% - 5rem);margin:.5rem auto}.background[_ngcontent-%COMP%]{justify-content:flex-start}}"]});let i=e;return i})();var _s="@firebase/database",gs="1.0.5";var fr="";function Ta(i){fr=i}var Ci=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),$(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:vn(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var vi=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Te(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Ks=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){let e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ci(e)}}catch{}return new vi},tt=Ks("localStorage"),yi=Ks("sessionStorage");var yt=new ls("@firebase/database"),Ea=function(){let i=1;return function(){return i++}}(),$s=function(i){let e=ss(i),t=new rs;t.update(e);let n=t.digest();return $r.encodeByteArray(n)},tn=function(...i){let e="";for(let t=0;t<i.length;t++){let n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=tn.apply(null,n):typeof n=="object"?e+=$(n):e+=n,e+=" "}return e},it=null,Cs=!0,Pa=function(i,e){C(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(yt.logLevel=as.VERBOSE,it=yt.log.bind(yt),e&&yi.set("logging_enabled",!0)):typeof i=="function"?it=i:(it=null,yi.remove("logging_enabled"))},oe=function(...i){if(Cs===!0&&(Cs=!1,it===null&&yi.get("logging_enabled")===!0&&Pa(!0)),it){let e=tn.apply(null,i);it(e)}},nn=function(i){return function(...e){oe(i,...e)}},wi=function(...i){let e="FIREBASE INTERNAL ERROR: "+tn(...i);yt.error(e)},Le=function(...i){let e=`FIREBASE FATAL ERROR: ${tn(...i)}`;throw yt.error(e),new Error(e)},de=function(...i){let e="FIREBASE WARNING: "+tn(...i);yt.warn(e)},Ia=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&de("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Qs=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},Oa=function(i){if(Me()||document.readyState==="complete")i();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},xt="[MIN_NAME]",rt="[MAX_NAME]",Pt=function(i,e){if(i===e)return 0;if(i===xt||e===rt)return-1;if(e===xt||i===rt)return 1;{let t=vs(i),n=vs(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},Na=function(i,e){return i===e?0:i<e?-1:1},jt=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+$(e))},mr=function(i){if(typeof i!="object"||i===null)return $(i);let e=[];for(let n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=$(e[n]),t+=":",t+=mr(i[e[n]]);return t+="}",t},Zs=function(i,e){let t=i.length;if(t<=e)return[i];let n=[];for(let r=0;r<t;r+=e)r+e>t?n.push(i.substring(r,t)):n.push(i.substring(r,r+e));return n};function ue(i,e){for(let t in i)i.hasOwnProperty(t)&&e(t,i[t])}var Xs=function(i){C(!Qs(i),"Invalid JSON number");let e=11,t=52,n=(1<<e-1)-1,r,s,o,a,l;i===0?(s=0,o=0,r=1/i===-1/0?1:0):(r=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(i)/Math.LN2),n),s=a+n,o=Math.round(i*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(i/Math.pow(2,1-n-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let p=parseInt(u.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),h=h+p}return h.toLowerCase()},Ra=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Fa=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function La(i,e){let t="Unknown Error";i==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?t="Client doesn't have permission to access the desired data.":i==="unavailable"&&(t="The service is unavailable");let n=new Error(i+" at "+e._path.toString()+": "+t);return n.code=i.toUpperCase(),n}var Aa=new RegExp("^-?(0*)\\d{1,10}$"),Da=-2147483648,Va=2147483647,vs=function(i){if(Aa.test(i)){let e=Number(i);if(e>=Da&&e<=Va)return e}return null},It=function(i){try{i()}catch(e){setTimeout(()=>{let t=e.stack||"";throw de("Exception was thrown by user callback.",t),e},Math.floor(0))}},ja=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Wt=function(i,e){let t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var xi=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){de(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var bi=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(oe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',de(e)}},zt=(()=>{class i{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}i.OWNER="owner";return i})(),kn="5",Js="v",eo="s",to="r",no="f",io=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ro="ls",so="p",Si="ac",oo="websocket",ao="long_polling";var Mn=class{constructor(e,t,n,r,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=tt.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&tt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Ga(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function lo(i,e,t){C(typeof e=="string","typeof type must == string"),C(typeof t=="object","typeof params must == object");let n;if(e===oo)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===ao)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Ga(i)&&(t.ns=i.namespace);let r=[];return ue(t,(s,o)=>{r.push(s+"="+o)}),n+r.join("&")}var ki=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Te(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Zr(this.counters_)}};var ui={},hi={};function _r(i){let e=i.toString();return ui[e]||(ui[e]=new ki),ui[e]}function Ba(i,e){let t=i.toString();return hi[t]||(hi[t]=e()),hi[t]}var Mi=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<n.length;++r)n[r]&&It(()=>{this.onMessage_(n[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var ys="start",Ha="close",Ua="pLPCommand",Wa="pRTLPCB",co="id",uo="pw",ho="ser",za="cb",qa="seg",Ya="ts",Ka="d",$a="dframe",po=1870,fo=30,Qa=po-fo,Za=25e3,Xa=3e4,Ti=class i{constructor(e,t,n,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nn(e),this.stats_=_r(t),this.urlFn=l=>(this.appCheckToken&&(l[Si]=this.appCheckToken),lo(t,ao,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Mi(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Xa)),Oa(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ei((...s)=>{let[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ys)this.id=a,this.password=l;else if(o===Ha)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let n={};n[ys]="t",n[ho]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[za]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Js]=kn,this.transportSessionId&&(n[eo]=this.transportSessionId),this.lastSessionId&&(n[ro]=this.lastSessionId),this.applicationId&&(n[so]=this.applicationId),this.appCheckToken&&(n[Si]=this.appCheckToken),typeof location<"u"&&location.hostname&&io.test(location.hostname)&&(n[to]=no);let r=this.urlFn(n);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){i.forceAllow_=!0}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){return Me()?!1:i.forceAllow_?!0:!i.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Ra()&&!Fa()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=$(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=Qr(t),r=Zs(n,Qa);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Me())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[$a]="t",n[co]=e,n[uo]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=$(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Ei=class i{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Me())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Ea(),window[Ua+this.uniqueCallbackIdentifier]=e,window[Wa+this.uniqueCallbackIdentifier]=t,this.myIFrame=i.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){oe("frame writing exception"),a.stack&&oe(a.stack),oe(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||oe("No IE domain setting required")}catch{let n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[co]=this.myID,e[uo]=this.myPW,e[ho]=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+fo+n.length<=po;){let o=this.pendingSegs.shift();n=n+"&"+qa+r+"="+o.seg+"&"+Ya+r+"="+o.ts+"&"+Ka+r+"="+o.d,r++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(Za)),s=()=>{clearTimeout(r),n()};this.addTag(e,s)}addTag(e,t){Me()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let r=n.readyState;(!r||r==="loaded"||r==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{oe("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}};var Ja=16384,el=45e3,Tn=null;typeof MozWebSocket<"u"?Tn=MozWebSocket:typeof WebSocket<"u"&&(Tn=WebSocket);var Gt=(()=>{class i{constructor(t,n,r,s,o,a,l){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nn(this.connId),this.stats_=_r(n),this.connURL=i.connectionURL_(n,a,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,r,s,o){let a={};return a[Js]=kn,!Me()&&typeof location<"u"&&location.hostname&&io.test(location.hostname)&&(a[to]=no),n&&(a[eo]=n),r&&(a[ro]=r),s&&(a[Si]=s),o&&(a[so]=o),lo(t,oo,a)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tt.set("previous_websocket_failure",!0);try{let r;if(Me()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${kn}/${fr}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new Tn(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&Tn!==null&&!i.forceDisallow_}static previouslyFailed(){return tt.isInMemoryStorage||tt.get("previous_websocket_failure")===!0}markConnectionHealthy(){tt.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let r=vn(n);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(C(this.frames===null,"We already have a frame buffer"),t.length<=6){let n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let n=$(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let r=Zs(n,Ja);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(el))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4;return i})(),tl=(()=>{class i{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Ti,Gt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let n=Gt&&Gt.isAvailable(),r=n&&!Gt.previouslyFailed();if(t.webSocketOnly&&(n||de("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Gt];else{let s=this.transports_=[];for(let o of i.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);i.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}i.globalTransportInitialized_=!1;return i})(),nl=6e4,il=5e3,rl=10*1024,sl=100*1024,pi="t",ws="d",ol="s",xs="r",al="e",bs="o",Ss="a",ks="n",Ms="p",ll="h",Pi=class{constructor(e,t,n,r,s,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nn("c:"+this.id+":"),this.transportManager_=new tl(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Wt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>sl?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>rl?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(pi in e){let t=e[pi];t===Ss?this.upgradeIfSecondaryHealthy_():t===xs?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===bs&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=jt("t",e),n=jt("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Ms,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ss,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ks,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=jt("t",e),n=jt("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=jt(pi,e);if(ws in e){let n=e[ws];if(t===ll){let r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===ks){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ol?this.onConnectionShutdown_(n):t===xs?this.onReset_(n):t===al?wi("Server Error: "+n):t===bs?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):wi("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),kn!==n&&de("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Wt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(nl))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Wt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(il))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Ms,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var En=class{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}};var Pn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},C(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let r=0;r<n.length;r++)n[r].callback.apply(n[r].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!n||n===r[s].context)){r.splice(s,1);return}}validateEventType_(e){C(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var In=class i extends Pn{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!li()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new i}getInitialEvent(e){return C(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Ts=32,Es=768,G=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function D(){return new G("")}function F(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function qe(i){return i.pieces_.length-i.pieceNum_}function U(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new G(i.pieces_,e)}function mo(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function cl(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function _o(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function go(i){if(i.pieceNum_>=i.pieces_.length)return null;let e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new G(e,0)}function Q(i,e){let t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof G)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{let n=e.split("/");for(let r=0;r<n.length;r++)n[r].length>0&&t.push(n[r])}return new G(t,0)}function R(i){return i.pieceNum_>=i.pieces_.length}function le(i,e){let t=F(i),n=F(e);if(t===null)return e;if(t===n)return le(U(i),U(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function Co(i,e){if(qe(i)!==qe(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function Se(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(qe(i)>qe(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}var Ii=class{constructor(e,t){this.errorPrefix_=t,this.parts_=_o(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Vt(this.parts_[n]);vo(this)}};function dl(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=Vt(e),vo(i)}function ul(i){let e=i.parts_.pop();i.byteLength_-=Vt(e),i.parts_.length>0&&(i.byteLength_-=1)}function vo(i){if(i.byteLength_>Es)throw new Error(i.errorPrefix_+"has a key path longer than "+Es+" bytes ("+i.byteLength_+").");if(i.parts_.length>Ts)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ts+") or object contains a cycle "+et(i))}function et(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}var Oi=class i extends Pn{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new i}getInitialEvent(e){return C(e==="visible","Unknown event type: "+e),[this.visible_]}};var Bt=1e3,hl=60*5*1e3,Ps=30*1e3,pl=1.3,fl=3e4,ml="server_kill",Is=3,gr=(()=>{class i extends En{constructor(t,n,r,s,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=i.nextPersistentConnectionId_++,this.log_=nn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Bt,this.maxReconnectDelay_=hl,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Me())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Oi.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&In.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,r){let s=++this.requestNumber_,o={r:s,a:t,b:n};this.log_($(o)),C(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let n=new Cn,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),n.promise}listen(t,n,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),C(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),C(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:n,query:t,tag:r};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let n=this.outstandingGets_[t];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(t){let n=t.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=n._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;i.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&Te(t,"w")){let r=Ze(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',o=n._path.toString();de(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ns(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Ps)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,n=ts(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let n=t.s,r=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(t,n){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),C(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,n)}sendUnlisten_(t,n,r,s){this.log_("Unlisten on "+t+" for "+n);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:r})}onDisconnectMerge(t,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:r})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,r,s){let o={p:n,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,n,r,s){this.putInternal("p",t,n,r,s)}merge(t,n,r,s){this.putInternal("m",t,n,r,s)}putInternal(t,n,r,s,o){this.initConnection_();let a={p:n,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(t){let n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,o=>{this.log_(n+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+$(t));let n=t.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):wi("Unrecognized action received from server: "+$(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){C(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Bt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Bt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>fl&&(this.reconnectDelay_=Bt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*pl)}this.onConnectStatus_(!1)}establishConnection_(){return S(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+i.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,r())},u=function(p){C(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[p,w]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?oe("getToken() completed but was canceled"):(oe("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=w&&w.token,l=new Pi(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,r,k=>{de(k+" ("+this.repoInfo_.toString()+")"),this.interrupt(ml)},o))}catch(p){this.log_("Failed to get token: "+p),a||(this.repoInfo_.nodeAdmin&&de(p),c())}}})}interrupt(t){oe("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){oe("Resuming connection for reason: "+t),delete this.interruptReasons_[t],ci(this.interruptReasons_)&&(this.reconnectDelay_=Bt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let r;n?r=n.map(o=>mr(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,n){let r=new G(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(n),o.delete(n),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,n){oe("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Is&&(this.reconnectDelay_=Ps,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){oe("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Is&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},n="js";Me()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),t["sdk."+n+"."+fr.replace(/\./g,"-")]=1,li()?t["framework.cordova"]=1:es()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=In.getInstance().currentlyOnline();return ci(this.interruptReasons_)&&t}}i.nextPersistentConnectionId_=0,i.nextConnectionId_=0;return i})(),O=class i{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new i(e,t)}};var bt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new O(xt,e),r=new O(xt,t);return this.compare(n,r)!==0}minPost(){return O.MIN}};var Sn,On=class extends bt{static get __EMPTY_NODE(){return Sn}static set __EMPTY_NODE(e){Sn=e}compare(e,t){return Pt(e.name,t.name)}isDefinedOn(e){throw ht("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return O.MIN}maxPost(){return new O(rt,Sn)}makePost(e,t){return C(typeof e=="string","KeyIndex indexValue must always be a string."),new O(e,Sn)}toString(){return".key"}},wt=new On;var vt=class{constructor(e,t,n,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},be=(()=>{class i{constructor(t,n,r,s,o){this.key=t,this.value=n,this.color=r??i.RED,this.left=s??ye.EMPTY_NODE,this.right=o??ye.EMPTY_NODE}copy(t,n,r,s,o){return new i(t??this.key,n??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,n,r),null):o===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ye.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let r,s;if(r=this,n(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(t,r.key)===0){if(r.right.isEmpty())return ye.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return i.RED=!0,i.BLACK=!1,i})(),Ni=class{copy(e,t,n,r,s){return this}insert(e,t,n){return new be(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ye=class i{constructor(e,t=i.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new i(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,be.BLACK,null,null))}remove(e){return new i(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,be.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(r=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new vt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new vt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new vt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new vt(this.root_,null,this.comparator_,!0,e)}};ye.EMPTY_NODE=new Ni;function _l(i,e){return Pt(i.name,e.name)}function Cr(i,e){return Pt(i,e)}var Ri;function gl(i){Ri=i}var yo=function(i){return typeof i=="number"?"number:"+Xs(i):"string:"+i},wo=function(i){if(i.isLeafNode()){let e=i.val();C(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Te(e,".sv"),"Priority must be a string or number.")}else C(i===Ri||i.isEmpty(),"priority of unexpected type.");C(i===Ri||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Os,St=(()=>{class i{constructor(t,n=i.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,C(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),wo(this.priorityNode_)}static set __childrenNodeConstructor(t){Os=t}static get __childrenNodeConstructor(){return Os}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new i(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return R(t)?this:F(t)===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:i.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let r=F(t);return r===null?n:n.isEmpty()&&r!==".priority"?this:(C(r!==".priority"||qe(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,i.__childrenNodeConstructor.EMPTY_NODE.updateChild(U(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+yo(this.priorityNode_.val())+":");let n=typeof this.value_;t+=n+":",n==="number"?t+=Xs(this.value_):t+=this.value_,this.lazyHash_=$s(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===i.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof i.__childrenNodeConstructor?-1:(C(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,r=typeof this.value_,s=i.VALUE_TYPE_ORDER.indexOf(n),o=i.VALUE_TYPE_ORDER.indexOf(r);return C(s>=0,"Unknown leaf type: "+n),C(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}i.VALUE_TYPE_ORDER=["object","boolean","number","string"];return i})(),xo,bo;function Cl(i){xo=i}function vl(i){bo=i}var Fi=class extends bt{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),s=n.compareTo(r);return s===0?Pt(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return O.MIN}maxPost(){return new O(rt,new St("[PRIORITY-POST]",bo))}makePost(e,t){let n=xo(e);return new O(t,new St("[PRIORITY-POST]",n))}toString(){return".priority"}},K=new Fi;var yl=Math.log(2),Li=class{constructor(e){let t=s=>parseInt(Math.log(s)/yl,10),n=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Nn=function(i,e,t,n){i.sort(e);let r=function(l,c){let u=c-l,h,p;if(u===0)return null;if(u===1)return h=i[l],p=t?t(h):h,new be(p,h.node,be.BLACK,null,null);{let w=parseInt(u/2,10)+l,k=r(l,w),B=r(w+1,c);return h=i[w],p=t?t(h):h,new be(p,h.node,be.BLACK,k,B)}},s=function(l){let c=null,u=null,h=i.length,p=function(k,B){let te=h-k,lt=h;h-=k;let un=r(te+1,lt),oi=i[te],ba=t?t(oi):oi;w(new be(ba,oi.node,B,null,un))},w=function(k){c?(c.left=k,c=k):(u=k,c=k)};for(let k=0;k<l.count;++k){let B=l.nextBitIsOne(),te=Math.pow(2,l.count-(k+1));B?p(te,be.BLACK):(p(te,be.BLACK),p(te,be.RED))}return u},o=new Li(i.length),a=s(o);return new ye(n||e,a)};var fi,Ct={},kt=class i{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return C(Ct&&K,"ChildrenNode.ts has not been loaded"),fi=fi||new i({".priority":Ct},{".priority":K}),fi}get(e){let t=Ze(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ye?t:null}hasIndex(e){return Te(this.indexSet_,e.toString())}addIndex(e,t){C(e!==wt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],r=!1,s=t.getIterator(O.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=s.getNext();let a;r?a=Nn(n,e.getCompare()):a=Ct;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new i(u,c)}addToIndexes(e,t){let n=Dt(this.indexes_,(r,s)=>{let o=Ze(this.indexSet_,s);if(C(o,"Missing index implementation for "+s),r===Ct)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(O.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Nn(a,o.getCompare())}else return Ct;else{let a=t.get(e.name),l=r;return a&&(l=l.remove(new O(e.name,a))),l.insert(e,e.node)}});return new i(n,this.indexSet_)}removeFromIndexes(e,t){let n=Dt(this.indexes_,r=>{if(r===Ct)return r;{let s=t.get(e.name);return s?r.remove(new O(e.name,s)):r}});return new i(n,this.indexSet_)}};var Ht,I=(()=>{class i{constructor(t,n,r){this.children_=t,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&wo(this.priorityNode_),this.children_.isEmpty()&&C(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ht||(Ht=new i(new ye(Cr),null,kt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ht}updatePriority(t){return this.children_.isEmpty()?this:new i(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let n=this.children_.get(t);return n===null?Ht:n}}getChild(t){let n=F(t);return n===null?this:this.getImmediateChild(n).getChild(U(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(C(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{let r=new O(t,n),s,o;n.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?Ht:this.priorityNode_;return new i(s,a,o)}}updateChild(t,n){let r=F(t);if(r===null)return n;{C(F(t)!==".priority"||qe(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(U(t),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},r=0,s=0,o=!0;if(this.forEachChild(K,(a,l)=>{n[a]=l.val(t),r++,o&&i.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let l in n)a[l]=n[l];return a}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+yo(this.getPriority().val())+":"),this.forEachChild(K,(n,r)=>{let s=r.hash();s!==""&&(t+=":"+n+":"+s)}),this.lazyHash_=t===""?"":$s(t)}return this.lazyHash_}getPredecessorChildName(t,n,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new O(t,n));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let n=this.resolveIndex_(t);if(n){let r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let n=this.getFirstChildName(t);return n?new O(n,this.children_.get(n)):null}getLastChildName(t){let n=this.resolveIndex_(t);if(n){let r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let n=this.getLastChildName(t);return n?new O(n,this.children_.get(n)):null}forEachChild(t,n){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){let r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,O.Wrap),o=s.peek();for(;o!=null&&n.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){let r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,O.Wrap),o=s.peek();for(;o!=null&&n.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===rn?-1:0}withIndex(t){if(t===wt||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new i(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===wt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let r=this.getIterator(K),s=n.getIterator(K),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===wt?null:this.indexMap_.get(t.toString())}}return i.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,i})(),Ai=class extends I{constructor(){super(new ye(Cr),I.EMPTY_NODE,kt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return I.EMPTY_NODE}isEmpty(){return!1}},rn=new Ai;Object.defineProperties(O,{MIN:{value:new O(xt,I.EMPTY_NODE)},MAX:{value:new O(rt,rn)}});On.__EMPTY_NODE=I.EMPTY_NODE;St.__childrenNodeConstructor=I;gl(rn);vl(rn);var wl=!0;function J(i,e=null){if(i===null)return I.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),C(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){let t=i;return new St(t,J(e))}if(!(i instanceof Array)&&wl){let t=[],n=!1;if(ue(i,(o,a)=>{if(o.substring(0,1)!=="."){let l=J(a);l.isEmpty()||(n=n||!l.getPriority().isEmpty(),t.push(new O(o,l)))}}),t.length===0)return I.EMPTY_NODE;let s=Nn(t,_l,o=>o.name,Cr);if(n){let o=Nn(t,K.getCompare());return new I(s,J(e),new kt({".priority":o},{".priority":K}))}else return new I(s,J(e),kt.Default)}else{let t=I.EMPTY_NODE;return ue(i,(n,r)=>{if(Te(i,n)&&n.substring(0,1)!=="."){let s=J(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(n,s))}}),t.updatePriority(J(e))}}Cl(J);var Di=class extends bt{constructor(e){super(),this.indexPath_=e,C(!R(e)&&F(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),s=n.compareTo(r);return s===0?Pt(e.name,t.name):s}makePost(e,t){let n=J(e),r=I.EMPTY_NODE.updateChild(this.indexPath_,n);return new O(t,r)}maxPost(){let e=I.EMPTY_NODE.updateChild(this.indexPath_,rn);return new O(rt,e)}toString(){return _o(this.indexPath_,0).join("/")}};var Vi=class extends bt{compare(e,t){let n=e.node.compareTo(t.node);return n===0?Pt(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return O.MIN}maxPost(){return O.MAX}makePost(e,t){let n=J(e);return new O(t,n)}toString(){return".value"}},xl=new Vi;function So(i){return{type:"value",snapshotNode:i}}function Mt(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function $t(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function Qt(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function bl(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}var Zt=class{constructor(e){this.index_=e}updateChild(e,t,n,r,s,o){C(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange($t(t,a)):C(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Mt(t,n)):o.trackChildChange(Qt(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(K,(r,s)=>{t.hasChild(r)||n.trackChildChange($t(r,s))}),t.isLeafNode()||t.forEachChild(K,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||n.trackChildChange(Qt(r,s,o))}else n.trackChildChange(Mt(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?I.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Rn=class i{constructor(e){this.indexedFilter_=new Zt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=i.getStartPost_(e),this.endPost_=i.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,s,o){return this.matches(new O(t,n))||(n=I.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,s,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=I.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(I.EMPTY_NODE);let s=this;return t.forEachChild(K,(o,a)=>{s.matches(new O(o,a))||(r=r.updateImmediateChild(o,I.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var ji=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{let n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new Rn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,s,o){return this.rangedFilter_.matches(new O(t,n))||(n=I.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,s,o):this.fullLimitUpdateChild_(e,t,n,s,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=I.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=I.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(I.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,I.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,s){let o;if(this.reverse_){let h=this.index_.getCompare();o=(p,w)=>h(w,p)}else o=this.index_.getCompare();let a=e;C(a.numChildren()===this.limit_,"");let l=new O(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let h=a.getImmediateChild(t),p=r.getChildAfterChild(this.index_,c,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);let w=p==null?1:o(p,l);if(u&&!n.isEmpty()&&w>=0)return s?.trackChildChange(Qt(t,n,h)),a.updateImmediateChild(t,n);{s?.trackChildChange($t(t,h));let B=a.updateImmediateChild(t,I.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(s?.trackChildChange(Mt(p.name,p.node)),B.updateImmediateChild(p.name,p.node)):B}}else return n.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange($t(c.name,c.node)),s.trackChildChange(Mt(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,I.EMPTY_NODE)):e}};var Gi=class i{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=K}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return C(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return C(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:xt}hasEnd(){return this.endSet_}getIndexEndValue(){return C(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return C(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:rt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return C(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===K}copy(){let e=new i;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Sl(i){return i.loadsAllData()?new Zt(i.getIndex()):i.hasLimit()?new ji(i):new Rn(i)}function Ns(i){let e={};if(i.isDefault())return e;let t;if(i.index_===K?t="$priority":i.index_===xl?t="$value":i.index_===wt?t="$key":(C(i.index_ instanceof Di,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=$(t),i.startSet_){let n=i.startAfterSet_?"startAfter":"startAt";e[n]=$(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+$(i.indexStartName_))}if(i.endSet_){let n=i.endBeforeSet_?"endBefore":"endAt";e[n]=$(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+$(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function Rs(i){let e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==K&&(e.i=i.index_.toString()),e}var Bi=class i extends En{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=nn("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(C(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=i.getListenId_(e,n),a={};this.listens_[o]=a;let l=Ns(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(s,h,!1,n),Ze(this.listens_,o)===a){let p;c?c===401?p="permission_denied":p="rest_error:"+c:p="ok",r(p,null)}})}unlisten(e,t){let n=i.getListenId_(e,t);delete this.listens_[n]}get(e){let t=Ns(e._queryParams),n=e._path.toString(),r=new Cn;return this.restRequest_(n+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(n,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+is(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=vn(a.responseText)}catch{de("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,l)}else a.status!==401&&a.status!==404&&de("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}};var Hi=class{constructor(){this.rootNode_=I.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Fn(){return{value:null,children:new Map}}function ko(i,e,t){if(R(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{let n=F(e);i.children.has(n)||i.children.set(n,Fn());let r=i.children.get(n);e=U(e),ko(r,e,t)}}function Ui(i,e,t){i.value!==null?t(e,i.value):kl(i,(n,r)=>{let s=new G(e.toString()+"/"+n);Ui(r,s,t)})}function kl(i,e){i.children.forEach((t,n)=>{e(n,t)})}var Wi=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ue(this.last_,(n,r)=>{t[n]=t[n]-r}),this.last_=e,t}};var Fs=10*1e3,Ml=30*1e3,Tl=5*60*1e3,zi=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Wi(e);let n=Fs+(Ml-Fs)*Math.random();Wt(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;ue(e,(r,s)=>{s>0&&Te(this.statsToReport_,r)&&(t[r]=s,n=!0)}),n&&this.server_.reportStats(t),Wt(this.reportStats_.bind(this),Math.floor(Math.random()*2*Tl))}};var Ee=function(i){return i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",i}(Ee||{});function Mo(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function vr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function yr(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}var qi=class i{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ee.ACK_USER_WRITE,this.source=Mo()}operationForChild(e){if(R(this.path)){if(this.affectedTree.value!=null)return C(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new G(e));return new i(D(),t,this.revert)}}else return C(F(this.path)===e,"operationForChild called for unrelated child."),new i(U(this.path),this.affectedTree,this.revert)}};var Ln=class i{constructor(e,t){this.source=e,this.path=t,this.type=Ee.LISTEN_COMPLETE}operationForChild(e){return R(this.path)?new i(this.source,D()):new i(this.source,U(this.path))}};var Tt=class i{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ee.OVERWRITE}operationForChild(e){return R(this.path)?new i(this.source,D(),this.snap.getImmediateChild(e)):new i(this.source,U(this.path),this.snap)}};var An=class i{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ee.MERGE}operationForChild(e){if(R(this.path)){let t=this.children.subtree(new G(e));return t.isEmpty()?null:t.value?new Tt(this.source,D(),t.value):new i(this.source,D(),t)}else return C(F(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new i(this.source,U(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Pe=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(R(e))return this.isFullyInitialized()&&!this.filtered_;let t=F(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Yi=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function El(i,e,t,n){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&i.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(bl(o.childName,o.snapshotNode))}),Ut(i,r,"child_removed",e,n,t),Ut(i,r,"child_added",e,n,t),Ut(i,r,"child_moved",s,n,t),Ut(i,r,"child_changed",e,n,t),Ut(i,r,"value",e,n,t),r}function Ut(i,e,t,n,r,s){let o=n.filter(a=>a.type===t);o.sort((a,l)=>Il(i,a,l)),o.forEach(a=>{let l=Pl(i,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,i.query_))})})}function Pl(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function Il(i,e,t){if(e.childName==null||t.childName==null)throw ht("Should only compare child_ events.");let n=new O(e.childName,e.snapshotNode),r=new O(t.childName,t.snapshotNode);return i.index_.compare(n,r)}function qn(i,e){return{eventCache:i,serverCache:e}}function qt(i,e,t,n){return qn(new Pe(e,t,n),i.serverCache)}function To(i,e,t,n){return qn(i.eventCache,new Pe(e,t,n))}function Dn(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function st(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}var mi,Ol=()=>(mi||(mi=new ye(Na)),mi),he=class i{constructor(e,t=Ol()){this.value=e,this.children=t}static fromObject(e){let t=new i(null);return ue(e,(n,r)=>{t=t.set(new G(n),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:D(),value:this.value};if(R(e))return null;{let n=F(e),r=this.children.get(n);if(r!==null){let s=r.findRootMostMatchingPathAndValue(U(e),t);return s!=null?{path:Q(new G(n),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(R(e))return this;{let t=F(e),n=this.children.get(t);return n!==null?n.subtree(U(e)):new i(null)}}set(e,t){if(R(e))return new i(t,this.children);{let n=F(e),s=(this.children.get(n)||new i(null)).set(U(e),t),o=this.children.insert(n,s);return new i(this.value,o)}}remove(e){if(R(e))return this.children.isEmpty()?new i(null):new i(null,this.children);{let t=F(e),n=this.children.get(t);if(n){let r=n.remove(U(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new i(null):new i(this.value,s)}else return this}}get(e){if(R(e))return this.value;{let t=F(e),n=this.children.get(t);return n?n.get(U(e)):null}}setTree(e,t){if(R(e))return t;{let n=F(e),s=(this.children.get(n)||new i(null)).setTree(U(e),t),o;return s.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,s),new i(this.value,o)}}fold(e){return this.fold_(D(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,s)=>{n[r]=s.fold_(Q(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,D(),t)}findOnPath_(e,t,n){let r=this.value?n(t,this.value):!1;if(r)return r;if(R(e))return null;{let s=F(e),o=this.children.get(s);return o?o.findOnPath_(U(e),Q(t,s),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,D(),t)}foreachOnPath_(e,t,n){if(R(e))return this;{this.value&&n(t,this.value);let r=F(e),s=this.children.get(r);return s?s.foreachOnPath_(U(e),Q(t,r),n):new i(null)}}foreach(e){this.foreach_(D(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(Q(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}};var ke=class i{constructor(e){this.writeTree_=e}static empty(){return new i(new he(null))}};function Yt(i,e,t){if(R(e))return new ke(new he(t));{let n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){let r=n.path,s=n.value,o=le(r,e);return s=s.updateChild(o,t),new ke(i.writeTree_.set(r,s))}else{let r=new he(t),s=i.writeTree_.setTree(e,r);return new ke(s)}}}function Ls(i,e,t){let n=i;return ue(t,(r,s)=>{n=Yt(n,Q(e,r),s)}),n}function As(i,e){if(R(e))return ke.empty();{let t=i.writeTree_.setTree(e,new he(null));return new ke(t)}}function Ki(i,e){return ot(i,e)!=null}function ot(i,e){let t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild(le(t.path,e)):null}function Ds(i){let e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(K,(n,r)=>{e.push(new O(n,r))}):i.writeTree_.children.inorderTraversal((n,r)=>{r.value!=null&&e.push(new O(n,r.value))}),e}function We(i,e){if(R(e))return i;{let t=ot(i,e);return t!=null?new ke(new he(t)):new ke(i.writeTree_.subtree(e))}}function $i(i){return i.writeTree_.isEmpty()}function Et(i,e){return Eo(D(),i.writeTree_,e)}function Eo(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(C(s.value!==null,"Priority writes must always be leaf nodes"),n=s.value):t=Eo(Q(i,r),s,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(Q(i,".priority"),n)),t}}function Yn(i,e){return No(e,i)}function Nl(i,e,t,n,r){C(n>i.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:r}),r&&(i.visibleWrites=Yt(i.visibleWrites,e,t)),i.lastWriteId=n}function Rl(i,e){for(let t=0;t<i.allWrites.length;t++){let n=i.allWrites[t];if(n.writeId===e)return n}return null}function Fl(i,e){let t=i.allWrites.findIndex(a=>a.writeId===e);C(t>=0,"removeWrite called with nonexistent writeId.");let n=i.allWrites[t];i.allWrites.splice(t,1);let r=n.visible,s=!1,o=i.allWrites.length-1;for(;r&&o>=0;){let a=i.allWrites[o];a.visible&&(o>=t&&Ll(a,n.path)?r=!1:Se(n.path,a.path)&&(s=!0)),o--}if(r){if(s)return Al(i),!0;if(n.snap)i.visibleWrites=As(i.visibleWrites,n.path);else{let a=n.children;ue(a,l=>{i.visibleWrites=As(i.visibleWrites,Q(n.path,l))})}return!0}else return!1}function Ll(i,e){if(i.snap)return Se(i.path,e);for(let t in i.children)if(i.children.hasOwnProperty(t)&&Se(Q(i.path,t),e))return!0;return!1}function Al(i){i.visibleWrites=Po(i.allWrites,Dl,D()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function Dl(i){return i.visible}function Po(i,e,t){let n=ke.empty();for(let r=0;r<i.length;++r){let s=i[r];if(e(s)){let o=s.path,a;if(s.snap)Se(t,o)?(a=le(t,o),n=Yt(n,a,s.snap)):Se(o,t)&&(a=le(o,t),n=Yt(n,D(),s.snap.getChild(a)));else if(s.children){if(Se(t,o))a=le(t,o),n=Ls(n,a,s.children);else if(Se(o,t))if(a=le(o,t),R(a))n=Ls(n,D(),s.children);else{let l=Ze(s.children,F(a));if(l){let c=l.getChild(U(a));n=Yt(n,D(),c)}}}else throw ht("WriteRecord should have .snap or .children")}}return n}function Io(i,e,t,n,r){if(!n&&!r){let s=ot(i.visibleWrites,e);if(s!=null)return s;{let o=We(i.visibleWrites,e);if($i(o))return t;if(t==null&&!Ki(o,D()))return null;{let a=t||I.EMPTY_NODE;return Et(o,a)}}}else{let s=We(i.visibleWrites,e);if(!r&&$i(s))return t;if(!r&&t==null&&!Ki(s,D()))return null;{let o=function(c){return(c.visible||r)&&(!n||!~n.indexOf(c.writeId))&&(Se(c.path,e)||Se(e,c.path))},a=Po(i.allWrites,o,e),l=t||I.EMPTY_NODE;return Et(a,l)}}}function Vl(i,e,t){let n=I.EMPTY_NODE,r=ot(i.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(K,(s,o)=>{n=n.updateImmediateChild(s,o)}),n;if(t){let s=We(i.visibleWrites,e);return t.forEachChild(K,(o,a)=>{let l=Et(We(s,new G(o)),a);n=n.updateImmediateChild(o,l)}),Ds(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{let s=We(i.visibleWrites,e);return Ds(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function jl(i,e,t,n,r){C(n||r,"Either existingEventSnap or existingServerSnap must exist");let s=Q(e,t);if(Ki(i.visibleWrites,s))return null;{let o=We(i.visibleWrites,s);return $i(o)?r.getChild(t):Et(o,r.getChild(t))}}function Gl(i,e,t,n){let r=Q(e,t),s=ot(i.visibleWrites,r);if(s!=null)return s;if(n.isCompleteForChild(t)){let o=We(i.visibleWrites,r);return Et(o,n.getNode().getImmediateChild(t))}else return null}function Bl(i,e){return ot(i.visibleWrites,e)}function Hl(i,e,t,n,r,s,o){let a,l=We(i.visibleWrites,e),c=ot(l,D());if(c!=null)a=c;else if(t!=null)a=Et(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),p=s?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),w=p.getNext();for(;w&&u.length<r;)h(w,n)!==0&&u.push(w),w=p.getNext();return u}else return[]}function Ul(){return{visibleWrites:ke.empty(),allWrites:[],lastWriteId:-1}}function Vn(i,e,t,n){return Io(i.writeTree,i.treePath,e,t,n)}function wr(i,e){return Vl(i.writeTree,i.treePath,e)}function Vs(i,e,t,n){return jl(i.writeTree,i.treePath,e,t,n)}function jn(i,e){return Bl(i.writeTree,Q(i.treePath,e))}function Wl(i,e,t,n,r,s){return Hl(i.writeTree,i.treePath,e,t,n,r,s)}function xr(i,e,t){return Gl(i.writeTree,i.treePath,e,t)}function Oo(i,e){return No(Q(i.treePath,e),i.writeTree)}function No(i,e){return{treePath:i,writeTree:e}}var Qi=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;C(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),C(n!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(n,Qt(n,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(n,$t(n,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(n,Mt(n,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(n,Qt(n,e.snapshotNode,r.oldSnap));else throw ht("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}};var Zi=class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},Ro=new Zi,Xt=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let n=this.optCompleteServerCache_!=null?new Pe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return xr(this.writes_,e,n)}}getChildAfterChild(e,t,n){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:st(this.viewCache_),s=Wl(this.writes_,r,t,1,n,e);return s.length===0?null:s[0]}};function zl(i){return{filter:i}}function ql(i,e){C(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),C(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function Yl(i,e,t,n,r){let s=new Qi,o,a;if(t.type===Ee.OVERWRITE){let c=t;c.source.fromUser?o=Xi(i,e,c.path,c.snap,n,r,s):(C(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!R(c.path),o=Gn(i,e,c.path,c.snap,n,r,a,s))}else if(t.type===Ee.MERGE){let c=t;c.source.fromUser?o=$l(i,e,c.path,c.children,n,r,s):(C(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Ji(i,e,c.path,c.children,n,r,a,s))}else if(t.type===Ee.ACK_USER_WRITE){let c=t;c.revert?o=Xl(i,e,c.path,n,r,s):o=Ql(i,e,c.path,c.affectedTree,n,r,s)}else if(t.type===Ee.LISTEN_COMPLETE)o=Zl(i,e,t.path,n,s);else throw ht("Unknown operation type: "+t.type);let l=s.getChanges();return Kl(e,o,l),{viewCache:o,changes:l}}function Kl(i,e,t){let n=e.eventCache;if(n.isFullyInitialized()){let r=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=Dn(i);(t.length>0||!i.eventCache.isFullyInitialized()||r&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&t.push(So(Dn(e)))}}function Fo(i,e,t,n,r,s){let o=e.eventCache;if(jn(n,t)!=null)return e;{let a,l;if(R(t))if(C(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=st(e),u=c instanceof I?c:I.EMPTY_NODE,h=wr(n,u);a=i.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{let c=Vn(n,st(e));a=i.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=F(t);if(c===".priority"){C(qe(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=Vs(n,t,u,l);h!=null?a=i.filter.updatePriority(u,h):a=o.getNode()}else{let u=U(t),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let p=Vs(n,t,o.getNode(),l);p!=null?h=o.getNode().getImmediateChild(c).updateChild(u,p):h=o.getNode().getImmediateChild(c)}else h=xr(n,c,e.serverCache);h!=null?a=i.filter.updateChild(o.getNode(),c,h,u,r,s):a=o.getNode()}}return qt(e,a,o.isFullyInitialized()||R(t),i.filter.filtersNodes())}}function Gn(i,e,t,n,r,s,o,a){let l=e.serverCache,c,u=o?i.filter:i.filter.getIndexedFilter();if(R(t))c=u.updateFullNode(l.getNode(),n,null);else if(u.filtersNodes()&&!l.isFiltered()){let w=l.getNode().updateChild(t,n);c=u.updateFullNode(l.getNode(),w,null)}else{let w=F(t);if(!l.isCompleteForPath(t)&&qe(t)>1)return e;let k=U(t),te=l.getNode().getImmediateChild(w).updateChild(k,n);w===".priority"?c=u.updatePriority(l.getNode(),te):c=u.updateChild(l.getNode(),w,te,k,Ro,null)}let h=To(e,c,l.isFullyInitialized()||R(t),u.filtersNodes()),p=new Xt(r,h,s);return Fo(i,h,t,r,p,a)}function Xi(i,e,t,n,r,s,o){let a=e.eventCache,l,c,u=new Xt(r,e,s);if(R(t))c=i.filter.updateFullNode(e.eventCache.getNode(),n,o),l=qt(e,c,!0,i.filter.filtersNodes());else{let h=F(t);if(h===".priority")c=i.filter.updatePriority(e.eventCache.getNode(),n),l=qt(e,c,a.isFullyInitialized(),a.isFiltered());else{let p=U(t),w=a.getNode().getImmediateChild(h),k;if(R(p))k=n;else{let B=u.getCompleteChild(h);B!=null?mo(p)===".priority"&&B.getChild(go(p)).isEmpty()?k=B:k=B.updateChild(p,n):k=I.EMPTY_NODE}if(w.equals(k))l=e;else{let B=i.filter.updateChild(a.getNode(),h,k,p,u,o);l=qt(e,B,a.isFullyInitialized(),i.filter.filtersNodes())}}}return l}function js(i,e){return i.eventCache.isCompleteForChild(e)}function $l(i,e,t,n,r,s,o){let a=e;return n.foreach((l,c)=>{let u=Q(t,l);js(e,F(u))&&(a=Xi(i,a,u,c,r,s,o))}),n.foreach((l,c)=>{let u=Q(t,l);js(e,F(u))||(a=Xi(i,a,u,c,r,s,o))}),a}function Gs(i,e,t){return t.foreach((n,r)=>{e=e.updateChild(n,r)}),e}function Ji(i,e,t,n,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;R(t)?c=n:c=new he(null).setTree(t,n);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,p)=>{if(u.hasChild(h)){let w=e.serverCache.getNode().getImmediateChild(h),k=Gs(i,w,p);l=Gn(i,l,new G(h),k,r,s,o,a)}}),c.children.inorderTraversal((h,p)=>{let w=!e.serverCache.isCompleteForChild(h)&&p.value===null;if(!u.hasChild(h)&&!w){let k=e.serverCache.getNode().getImmediateChild(h),B=Gs(i,k,p);l=Gn(i,l,new G(h),B,r,s,o,a)}}),l}function Ql(i,e,t,n,r,s,o){if(jn(r,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(n.value!=null){if(R(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Gn(i,e,t,l.getNode().getChild(t),r,s,a,o);if(R(t)){let c=new he(null);return l.getNode().forEachChild(wt,(u,h)=>{c=c.set(new G(u),h)}),Ji(i,e,t,c,r,s,a,o)}else return e}else{let c=new he(null);return n.foreach((u,h)=>{let p=Q(t,u);l.isCompleteForPath(p)&&(c=c.set(u,l.getNode().getChild(p)))}),Ji(i,e,t,c,r,s,a,o)}}function Zl(i,e,t,n,r){let s=e.serverCache,o=To(e,s.getNode(),s.isFullyInitialized()||R(t),s.isFiltered());return Fo(i,o,t,n,Ro,r)}function Xl(i,e,t,n,r,s){let o;if(jn(n,t)!=null)return e;{let a=new Xt(n,e,r),l=e.eventCache.getNode(),c;if(R(t)||F(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Vn(n,st(e));else{let h=e.serverCache.getNode();C(h instanceof I,"serverChildren would be complete if leaf node"),u=wr(n,h)}u=u,c=i.filter.updateFullNode(l,u,s)}else{let u=F(t),h=xr(n,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=i.filter.updateChild(l,u,h,U(t),a,s):e.eventCache.getNode().hasChild(u)?c=i.filter.updateChild(l,u,I.EMPTY_NODE,U(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Vn(n,st(e)),o.isLeafNode()&&(c=i.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||jn(n,D())!=null,qt(e,c,o,i.filter.filtersNodes())}}var er=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,r=new Zt(n.getIndex()),s=Sl(n);this.processor_=zl(s);let o=t.serverCache,a=t.eventCache,l=r.updateFullNode(I.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(I.EMPTY_NODE,a.getNode(),null),u=new Pe(l,o.isFullyInitialized(),r.filtersNodes()),h=new Pe(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=qn(h,u),this.eventGenerator_=new Yi(this.query_)}get query(){return this.query_}};function Jl(i){return i.viewCache_.serverCache.getNode()}function ec(i){return Dn(i.viewCache_)}function tc(i,e){let t=st(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!R(e)&&!t.getImmediateChild(F(e)).isEmpty())?t.getChild(e):null}function Bs(i){return i.eventRegistrations_.length===0}function nc(i,e){i.eventRegistrations_.push(e)}function Hs(i,e,t){let n=[];if(t){C(e==null,"A cancel should cancel all event registrations.");let r=i.query._path;i.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&n.push(o)})}if(e){let r=[];for(let s=0;s<i.eventRegistrations_.length;++s){let o=i.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(i.eventRegistrations_.slice(s+1));break}}i.eventRegistrations_=r}else i.eventRegistrations_=[];return n}function Us(i,e,t,n){e.type===Ee.MERGE&&e.source.queryId!==null&&(C(st(i.viewCache_),"We should always have a full cache before handling merges"),C(Dn(i.viewCache_),"Missing event cache, even though we have a server cache"));let r=i.viewCache_,s=Yl(i.processor_,r,e,t,n);return ql(i.processor_,s.viewCache),C(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=s.viewCache,Lo(i,s.changes,s.viewCache.eventCache.getNode(),null)}function ic(i,e){let t=i.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(K,(s,o)=>{n.push(Mt(s,o))}),t.isFullyInitialized()&&n.push(So(t.getNode())),Lo(i,n,t.getNode(),e)}function Lo(i,e,t,n){let r=n?[n]:i.eventRegistrations_;return El(i.eventGenerator_,e,t,r)}var Bn,Hn=class{constructor(){this.views=new Map}};function rc(i){C(!Bn,"__referenceConstructor has already been defined"),Bn=i}function sc(){return C(Bn,"Reference.ts has not been loaded"),Bn}function oc(i){return i.views.size===0}function br(i,e,t,n){let r=e.source.queryId;if(r!==null){let s=i.views.get(r);return C(s!=null,"SyncTree gave us an op for an invalid query."),Us(s,e,t,n)}else{let s=[];for(let o of i.views.values())s=s.concat(Us(o,e,t,n));return s}}function Ao(i,e,t,n,r){let s=e._queryIdentifier,o=i.views.get(s);if(!o){let a=Vn(t,r?n:null),l=!1;a?l=!0:n instanceof I?(a=wr(t,n),l=!1):(a=I.EMPTY_NODE,l=!1);let c=qn(new Pe(a,l,!1),new Pe(n,r,!1));return new er(e,c)}return o}function ac(i,e,t,n,r,s){let o=Ao(i,e,n,r,s);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,o),nc(o,t),ic(o,t)}function lc(i,e,t,n){let r=e._queryIdentifier,s=[],o=[],a=Ye(i);if(r==="default")for(let[l,c]of i.views.entries())o=o.concat(Hs(c,t,n)),Bs(c)&&(i.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{let l=i.views.get(r);l&&(o=o.concat(Hs(l,t,n)),Bs(l)&&(i.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!Ye(i)&&s.push(new(sc())(e._repo,e._path)),{removed:s,events:o}}function Do(i){let e=[];for(let t of i.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ze(i,e){let t=null;for(let n of i.views.values())t=t||tc(n,e);return t}function Vo(i,e){if(e._queryParams.loadsAllData())return Kn(i);{let n=e._queryIdentifier;return i.views.get(n)}}function jo(i,e){return Vo(i,e)!=null}function Ye(i){return Kn(i)!=null}function Kn(i){for(let e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Un;function cc(i){C(!Un,"__referenceConstructor has already been defined"),Un=i}function dc(){return C(Un,"Reference.ts has not been loaded"),Un}var uc=1,Wn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new he(null),this.pendingWriteTree_=Ul(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Go(i,e,t,n,r){return Nl(i.pendingWriteTree_,e,t,n,r),r?on(i,new Tt(Mo(),e,t)):[]}function nt(i,e,t=!1){let n=Rl(i.pendingWriteTree_,e);if(Fl(i.pendingWriteTree_,e)){let s=new he(null);return n.snap!=null?s=s.set(D(),!0):ue(n.children,o=>{s=s.set(new G(o),!0)}),on(i,new qi(n.path,s,t))}else return[]}function sn(i,e,t){return on(i,new Tt(vr(),e,t))}function hc(i,e,t){let n=he.fromObject(t);return on(i,new An(vr(),e,n))}function pc(i,e){return on(i,new Ln(vr(),e))}function fc(i,e,t){let n=kr(i,t);if(n){let r=Mr(n),s=r.path,o=r.queryId,a=le(s,e),l=new Ln(yr(o),a);return Tr(i,s,l)}else return[]}function Bo(i,e,t,n,r=!1){let s=e._path,o=i.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||jo(o,e))){let l=lc(o,e,t,n);oc(o)&&(i.syncPointTree_=i.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!r){let u=c.findIndex(p=>p._queryParams.loadsAllData())!==-1,h=i.syncPointTree_.findOnPath(s,(p,w)=>Ye(w));if(u&&!h){let p=i.syncPointTree_.subtree(s);if(!p.isEmpty()){let w=Cc(p);for(let k=0;k<w.length;++k){let B=w[k],te=B.query,lt=zo(i,B);i.listenProvider_.startListening(Kt(te),Jt(i,te),lt.hashFn,lt.onComplete)}}}!h&&c.length>0&&!n&&(u?i.listenProvider_.stopListening(Kt(e),null):c.forEach(p=>{let w=i.queryToTagMap.get($n(p));i.listenProvider_.stopListening(Kt(p),w)}))}vc(i,c)}return a}function Ho(i,e,t,n){let r=kr(i,n);if(r!=null){let s=Mr(r),o=s.path,a=s.queryId,l=le(o,e),c=new Tt(yr(a),l,t);return Tr(i,o,c)}else return[]}function mc(i,e,t,n){let r=kr(i,n);if(r){let s=Mr(r),o=s.path,a=s.queryId,l=le(o,e),c=he.fromObject(t),u=new An(yr(a),l,c);return Tr(i,o,u)}else return[]}function _c(i,e,t,n=!1){let r=e._path,s=null,o=!1;i.syncPointTree_.foreachOnPath(r,(p,w)=>{let k=le(p,r);s=s||ze(w,k),o=o||Ye(w)});let a=i.syncPointTree_.get(r);a?(o=o||Ye(a),s=s||ze(a,D())):(a=new Hn,i.syncPointTree_=i.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=I.EMPTY_NODE,i.syncPointTree_.subtree(r).foreachChild((w,k)=>{let B=ze(k,D());B&&(s=s.updateImmediateChild(w,B))}));let c=jo(a,e);if(!c&&!e._queryParams.loadsAllData()){let p=$n(e);C(!i.queryToTagMap.has(p),"View does not exist, but we have a tag");let w=yc();i.queryToTagMap.set(p,w),i.tagToQueryMap.set(w,p)}let u=Yn(i.pendingWriteTree_,r),h=ac(a,e,t,u,s,l);if(!c&&!o&&!n){let p=Vo(a,e);h=h.concat(wc(i,e,p))}return h}function Sr(i,e,t){let r=i.pendingWriteTree_,s=i.syncPointTree_.findOnPath(e,(o,a)=>{let l=le(o,e),c=ze(a,l);if(c)return c});return Io(r,e,s,t,!0)}function gc(i,e){let t=e._path,n=null;i.syncPointTree_.foreachOnPath(t,(c,u)=>{let h=le(c,t);n=n||ze(u,h)});let r=i.syncPointTree_.get(t);r?n=n||ze(r,D()):(r=new Hn,i.syncPointTree_=i.syncPointTree_.set(t,r));let s=n!=null,o=s?new Pe(n,!0,!1):null,a=Yn(i.pendingWriteTree_,e._path),l=Ao(r,e,a,s?o.getNode():I.EMPTY_NODE,s);return ec(l)}function on(i,e){return Uo(e,i.syncPointTree_,null,Yn(i.pendingWriteTree_,D()))}function Uo(i,e,t,n){if(R(i.path))return Wo(i,e,t,n);{let r=e.get(D());t==null&&r!=null&&(t=ze(r,D()));let s=[],o=F(i.path),a=i.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=Oo(n,o);s=s.concat(Uo(a,l,c,u))}return r&&(s=s.concat(br(r,i,n,t))),s}}function Wo(i,e,t,n){let r=e.get(D());t==null&&r!=null&&(t=ze(r,D()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=Oo(n,o),u=i.operationForChild(o);u&&(s=s.concat(Wo(u,a,l,c)))}),r&&(s=s.concat(br(r,i,n,t))),s}function zo(i,e){let t=e.query,n=Jt(i,t);return{hashFn:()=>(Jl(e)||I.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return n?fc(i,t._path,n):pc(i,t._path);{let s=La(r,t);return Bo(i,t,null,s)}}}}function Jt(i,e){let t=$n(e);return i.queryToTagMap.get(t)}function $n(i){return i._path.toString()+"$"+i._queryIdentifier}function kr(i,e){return i.tagToQueryMap.get(e)}function Mr(i){let e=i.indexOf("$");return C(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new G(i.substr(0,e))}}function Tr(i,e,t){let n=i.syncPointTree_.get(e);C(n,"Missing sync point for query tag that we're tracking");let r=Yn(i.pendingWriteTree_,e);return br(n,t,r,null)}function Cc(i){return i.fold((e,t,n)=>{if(t&&Ye(t))return[Kn(t)];{let r=[];return t&&(r=Do(t)),ue(n,(s,o)=>{r=r.concat(o)}),r}})}function Kt(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(dc())(i._repo,i._path):i}function vc(i,e){for(let t=0;t<e.length;++t){let n=e[t];if(!n._queryParams.loadsAllData()){let r=$n(n),s=i.queryToTagMap.get(r);i.queryToTagMap.delete(r),i.tagToQueryMap.delete(s)}}}function yc(){return uc++}function wc(i,e,t){let n=e._path,r=Jt(i,e),s=zo(i,t),o=i.listenProvider_.startListening(Kt(e),r,s.hashFn,s.onComplete),a=i.syncPointTree_.subtree(n);if(r)C(!Ye(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!R(c)&&u&&Ye(u))return[Kn(u).query];{let p=[];return u&&(p=p.concat(Do(u).map(w=>w.query))),ue(h,(w,k)=>{p=p.concat(k)}),p}});for(let c=0;c<l.length;++c){let u=l[c];i.listenProvider_.stopListening(Kt(u),Jt(i,u))}}return o}var tr=class i{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new i(t)}node(){return this.node_}},nr=class i{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Q(this.path_,e);return new i(this.syncTree_,t)}node(){return Sr(this.syncTree_,this.path_)}},xc=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},Ws=function(i,e,t){if(!i||typeof i!="object")return i;if(C(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return bc(i[".sv"],e,t);if(typeof i[".sv"]=="object")return Sc(i[".sv"],e);C(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},bc=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:C(!1,"Unexpected server value: "+i)}},Sc=function(i,e,t){i.hasOwnProperty("increment")||C(!1,"Unexpected server value: "+JSON.stringify(i,null,2));let n=i.increment;typeof n!="number"&&C(!1,"Unexpected increment value: "+n);let r=e.node();if(C(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return n;let o=r.getValue();return typeof o!="number"?n:o+n},kc=function(i,e,t,n){return Er(e,new nr(t,i),n)},qo=function(i,e,t){return Er(i,new tr(e),t)};function Er(i,e,t){let n=i.getPriority().val(),r=Ws(n,e.getImmediateChild(".priority"),t),s;if(i.isLeafNode()){let o=i,a=Ws(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new St(a,J(r)):i}else{let o=i;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new St(r))),o.forEachChild(K,(a,l)=>{let c=Er(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}var en=class{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function Pr(i,e){let t=e instanceof G?e:new G(e),n=i,r=F(t);for(;r!==null;){let s=Ze(n.node.children,r)||{children:{},childCount:0};n=new en(r,n,s),t=U(t),r=F(t)}return n}function Ot(i){return i.node.value}function Yo(i,e){i.node.value=e,ir(i)}function Ko(i){return i.node.childCount>0}function Mc(i){return Ot(i)===void 0&&!Ko(i)}function Qn(i,e){ue(i.node.children,(t,n)=>{e(new en(t,i,n))})}function $o(i,e,t,n){t&&!n&&e(i),Qn(i,r=>{$o(r,e,!0,n)}),t&&n&&e(i)}function Tc(i,e,t){let n=t?i:i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function an(i){return new G(i.parent===null?i.name:an(i.parent)+"/"+i.name)}function ir(i){i.parent!==null&&Ec(i.parent,i.name,i)}function Ec(i,e,t){let n=Mc(t),r=Te(i.node.children,e);n&&r?(delete i.node.children[e],i.node.childCount--,ir(i)):!n&&!r&&(i.node.children[e]=t.node,i.node.childCount++,ir(i))}var Pc=/[\[\].#$\/\u0000-\u001F\u007F]/,Ic=/[\[\].#$\u0000-\u001F\u007F]/,_i=10*1024*1024,Qo=function(i){return typeof i=="string"&&i.length!==0&&!Pc.test(i)},Zo=function(i){return typeof i=="string"&&i.length!==0&&!Ic.test(i)},Oc=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Zo(i)};var Nc=function(i,e,t,n){n&&e===void 0||Ir(yn(i,"value"),e,t)},Ir=function(i,e,t){let n=t instanceof G?new Ii(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+et(n));if(typeof e=="function")throw new Error(i+"contains a function "+et(n)+" with contents = "+e.toString());if(Qs(e))throw new Error(i+"contains "+e.toString()+" "+et(n));if(typeof e=="string"&&e.length>_i/3&&Vt(e)>_i)throw new Error(i+"contains a string greater than "+_i+" utf8 bytes "+et(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(ue(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Qo(o)))throw new Error(i+" contains an invalid key ("+o+") "+et(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);dl(n,o),Ir(i,a,n),ul(n)}),r&&s)throw new Error(i+' contains ".value" child '+et(n)+" in addition to actual children.")}};var Xo=function(i,e,t,n){if(!(n&&t===void 0)&&!Zo(t))throw new Error(yn(i,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Rc=function(i,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Xo(i,e,t,n)},Jo=function(i,e){if(F(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},Fc=function(i,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Qo(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Oc(t))throw new Error(yn(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var rr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function ea(i,e){let t=null;for(let n=0;n<e.length;n++){let r=e[n],s=r.getPath();t!==null&&!Co(s,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&i.eventLists_.push(t)}function Ie(i,e,t){ea(i,t),Lc(i,n=>Se(n,e)||Se(e,n))}function Lc(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){let r=i.eventLists_[n];if(r){let s=r.path;e(s)?(Ac(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function Ac(i){for(let e=0;e<i.events.length;e++){let t=i.events[e];if(t!==null){i.events[e]=null;let n=t.getEventRunner();it&&oe("event: "+t.toString()),It(n)}}}var Dc="repo_interrupt",Vc=25,sr=class{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fn(),this.transactionQueueTree_=new en,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function jc(i,e,t){if(i.stats_=_r(i.repoInfo_),i.forceRestClient_||ja())i.server_=new Bi(i.repoInfo_,(n,r,s,o)=>{zs(i,n,r,s,o)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>qs(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{$(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new gr(i.repoInfo_,e,(n,r,s,o)=>{zs(i,n,r,s,o)},n=>{qs(i,n)},n=>{Bc(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=Ba(i.repoInfo_,()=>new zi(i.stats_,i.server_)),i.infoData_=new Hi,i.infoSyncTree_=new Wn({startListening:(n,r,s,o)=>{let a=[],l=i.infoData_.getNode(n._path);return l.isEmpty()||(a=sn(i.infoSyncTree_,n._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Nr(i,"connected",!1),i.serverSyncTree_=new Wn({startListening:(n,r,s,o)=>(i.server_.listen(n,s,r,(a,l)=>{let c=o(a,l);Ie(i.eventQueue_,n._path,c)}),[]),stopListening:(n,r)=>{i.server_.unlisten(n,r)}})}function Gc(i){let t=i.infoData_.getNode(new G(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Or(i){return xc({timestamp:Gc(i)})}function zs(i,e,t,n,r){i.dataUpdateCount++;let s=new G(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(n){let l=Dt(t,c=>J(c));o=mc(i.serverSyncTree_,s,l,r)}else{let l=J(t);o=Ho(i.serverSyncTree_,s,l,r)}else if(n){let l=Dt(t,c=>J(c));o=hc(i.serverSyncTree_,s,l)}else{let l=J(t);o=sn(i.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Xn(i,s)),Ie(i.eventQueue_,a,o)}function qs(i,e){Nr(i,"connected",e),e===!1&&Wc(i)}function Bc(i,e){ue(e,(t,n)=>{Nr(i,t,n)})}function Nr(i,e,t){let n=new G("/.info/"+e),r=J(t);i.infoData_.updateSnapshot(n,r);let s=sn(i.infoSyncTree_,n,r);Ie(i.eventQueue_,n,s)}function ta(i){return i.nextWriteId_++}function Hc(i,e,t){let n=gc(i.serverSyncTree_,e);return n!=null?Promise.resolve(n):i.server_.get(e).then(r=>{let s=J(r).withIndex(e._queryParams.getIndex());_c(i.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=sn(i.serverSyncTree_,e._path,s);else{let a=Jt(i.serverSyncTree_,e);o=Ho(i.serverSyncTree_,e._path,s,a)}return Ie(i.eventQueue_,e._path,o),Bo(i.serverSyncTree_,e,t,null,!0),s},r=>(Zn(i,"get for query "+$(e)+" failed: "+r),Promise.reject(new Error(r))))}function Uc(i,e,t,n,r){Zn(i,"set",{path:e.toString(),value:t,priority:n});let s=Or(i),o=J(t,n),a=Sr(i.serverSyncTree_,e),l=qo(o,a,s),c=ta(i),u=Go(i.serverSyncTree_,e,l,c,!0);ea(i.eventQueue_,u),i.server_.put(e.toString(),o.val(!0),(p,w)=>{let k=p==="ok";k||de("set at "+e+" failed: "+p);let B=nt(i.serverSyncTree_,c,!k);Ie(i.eventQueue_,e,B),qc(i,r,p,w)});let h=oa(i,e);Xn(i,h),Ie(i.eventQueue_,h,[])}function Wc(i){Zn(i,"onDisconnectEvents");let e=Or(i),t=Fn();Ui(i.onDisconnect_,D(),(r,s)=>{let o=kc(r,s,i.serverSyncTree_,e);ko(t,r,o)});let n=[];Ui(t,D(),(r,s)=>{n=n.concat(sn(i.serverSyncTree_,r,s));let o=oa(i,r);Xn(i,o)}),i.onDisconnect_=Fn(),Ie(i.eventQueue_,D(),n)}function zc(i){i.persistentConnection_&&i.persistentConnection_.interrupt(Dc)}function Zn(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),oe(t,...e)}function qc(i,e,t,n){e&&It(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;n&&(s+=": "+n);let o=new Error(s);o.code=r,e(o)}})}function na(i,e,t){return Sr(i.serverSyncTree_,e,t)||I.EMPTY_NODE}function Rr(i,e=i.transactionQueueTree_){if(e||Jn(i,e),Ot(e)){let t=ra(i,e);C(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&Yc(i,an(e),t)}else Ko(e)&&Qn(e,t=>{Rr(i,t)})}function Yc(i,e,t){let n=t.map(c=>c.currentWriteId),r=na(i,e,n),s=r,o=r.hash();for(let c=0;c<t.length;c++){let u=t[c];C(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=le(e,u.path);s=s.updateChild(h,u.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;i.server_.put(l.toString(),a,c=>{Zn(i,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let p=0;p<t.length;p++)t[p].status=2,u=u.concat(nt(i.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&h.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();Jn(i,Pr(i.transactionQueueTree_,e)),Rr(i,i.transactionQueueTree_),Ie(i.eventQueue_,e,u);for(let p=0;p<h.length;p++)It(h[p])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{de("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}Xn(i,e)}},o)}function Xn(i,e){let t=ia(i,e),n=an(t),r=ra(i,t);return Kc(i,r,n),n}function Kc(i,e,t){if(e.length===0)return;let n=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=le(t,l.path),u=!1,h;if(C(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,r=r.concat(nt(i.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Vc)u=!0,h="maxretry",r=r.concat(nt(i.serverSyncTree_,l.currentWriteId,!0));else{let p=na(i,l.path,o);l.currentInputSnapshot=p;let w=e[a].update(p.val());if(w!==void 0){Ir("transaction failed: Data returned ",w,l.path);let k=J(w);typeof w=="object"&&w!=null&&Te(w,".priority")||(k=k.updatePriority(p.getPriority()));let te=l.currentWriteId,lt=Or(i),un=qo(k,p,lt);l.currentOutputSnapshotRaw=k,l.currentOutputSnapshotResolved=un,l.currentWriteId=ta(i),o.splice(o.indexOf(te),1),r=r.concat(Go(i.serverSyncTree_,l.path,un,l.currentWriteId,l.applyLocally)),r=r.concat(nt(i.serverSyncTree_,te,!0))}else u=!0,h="nodata",r=r.concat(nt(i.serverSyncTree_,l.currentWriteId,!0))}Ie(i.eventQueue_,t,r),r=[],u&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(h),!1,null))))}Jn(i,i.transactionQueueTree_);for(let a=0;a<n.length;a++)It(n[a]);Rr(i,i.transactionQueueTree_)}function ia(i,e){let t,n=i.transactionQueueTree_;for(t=F(e);t!==null&&Ot(n)===void 0;)n=Pr(n,t),e=U(e),t=F(e);return n}function ra(i,e){let t=[];return sa(i,e,t),t.sort((n,r)=>n.order-r.order),t}function sa(i,e,t){let n=Ot(e);if(n)for(let r=0;r<n.length;r++)t.push(n[r]);Qn(e,r=>{sa(i,r,t)})}function Jn(i,e){let t=Ot(e);if(t){let n=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[n]=t[r],n++);t.length=n,Yo(e,t.length>0?t:void 0)}Qn(e,n=>{Jn(i,n)})}function oa(i,e){let t=an(ia(i,e)),n=Pr(i.transactionQueueTree_,e);return Tc(n,r=>{gi(i,r)}),gi(i,n),$o(n,r=>{gi(i,r)}),t}function gi(i,e){let t=Ot(e);if(t){let n=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(C(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(C(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(nt(i.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Yo(e,void 0):t.length=s+1,Ie(i.eventQueue_,an(e),r);for(let o=0;o<n.length;o++)It(n[o])}}function $c(i){let e="",t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let r=t[n];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function Qc(i){let e={};i.charAt(0)==="?"&&(i=i.substring(1));for(let t of i.split("&")){if(t.length===0)continue;let n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):de(`Invalid query segment '${t}' in query '${i}'`)}return e}var Ys=function(i,e){let t=Zc(i),n=t.namespace;t.domain==="firebase.com"&&Le(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Le("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Ia();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Mn(t.host,t.secure,n,r,e,"",n!==t.subdomain),path:new G(t.pathString)}},Zc=function(i){let e="",t="",n="",r="",s="",o=!0,a="https",l=443;if(typeof i=="string"){let c=i.indexOf("//");c>=0&&(a=i.substring(0,c-1),i=i.substring(c+2));let u=i.indexOf("/");u===-1&&(u=i.length);let h=i.indexOf("?");h===-1&&(h=i.length),e=i.substring(0,Math.min(u,h)),u<h&&(r=$c(i.substring(u,h)));let p=Qc(i.substring(Math.min(i.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let w=e.slice(0,c);if(w.toLowerCase()==="localhost")t="localhost";else if(w.split(".").length<=2)t=w;else{let k=e.indexOf(".");n=e.substring(0,k).toLowerCase(),t=e.substring(k+1),s=n}"ns"in p&&(s=p.ns)}return{host:e,port:l,domain:t,subdomain:n,secure:o,scheme:a,pathString:r,namespace:s}};var or=class{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+$(this.snapshot.exportVal())}},ar=class{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var lr=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return C(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var cr=class i{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return R(this._path)?null:mo(this._path)}get ref(){return new Ae(this._repo,this._path)}get _queryIdentifier(){let e=Rs(this._queryParams),t=mr(e);return t==="{}"?"default":t}get _queryObject(){return Rs(this._queryParams)}isEqual(e){if(e=Xe(e),!(e instanceof i))return!1;let t=this._repo===e._repo,n=Co(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+cl(this._path)}};var Ae=class i extends cr{constructor(e,t){super(e,t,new Gi,!1)}get parent(){let e=go(this._path);return e===null?null:new i(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},zn=class i{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new G(e),n=dr(this.ref,e);return new i(this._node.getChild(t),n,K)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,r)=>e(new i(r,dr(this.ref,n),K)))}hasChild(e){let t=new G(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function we(i,e){return i=Xe(i),i._checkNotDeleted("ref"),e!==void 0?dr(i._root,e):i._root}function dr(i,e){return i=Xe(i),F(i._path)===null?Rc("child","path",e,!1):Xo("child","path",e,!1),new Ae(i._repo,Q(i._path,e))}function Fr(i){return Jo("remove",i._path),at(i,null)}function at(i,e){i=Xe(i),Jo("set",i._path),Nc("set",e,i._path,!1);let t=new Cn;return Uc(i._repo,i._path,e,null,t.wrapCallback(()=>{})),t.promise}function ln(i){i=Xe(i);let e=new lr(()=>{}),t=new ur(e);return Hc(i._repo,i,t).then(n=>new zn(n,new Ae(i._repo,i._path),i._queryParams.getIndex()))}var ur=class i{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let n=t._queryParams.getIndex();return new or("value",this,new zn(e.snapshotNode,new Ae(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ar(this,e,t):null}matches(e){return e instanceof i?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}};rc(Ae);cc(Ae);var Xc="FIREBASE_DATABASE_EMULATOR_HOST",hr={},Jc=!1;function ed(i,e,t,n){i.repoInfo_=new Mn(`${e}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0),n&&(i.authTokenProvider_=n)}function td(i,e,t,n,r){let s=n||i.options.databaseURL;s===void 0&&(i.options.projectId||Le("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),oe("Using default host for project ",i.options.projectId),s=`${i.options.projectId}-default-rtdb.firebaseio.com`);let o=Ys(s,r),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Xc]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=Ys(s,r),a=o.repoInfo):l=!o.repoInfo.secure;let u=r&&l?new zt(zt.OWNER):new bi(i.name,i.options,e);Fc("Invalid Firebase Database URL",o),R(o.path)||Le("Database URL must point to the root of a Firebase Database (not including a child path).");let h=id(a,i,u,new xi(i.name,t));return new pr(h,i)}function nd(i,e){let t=hr[e];(!t||t[i.key]!==i)&&Le(`Database ${e}(${i.repoInfo_}) has already been deleted.`),zc(i),delete t[i.key]}function id(i,e,t,n){let r=hr[e.name];r||(r={},hr[e.name]=r);let s=r[i.toURLString()];return s&&Le("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new sr(i,Jc,t,n),r[i.toURLString()]=s,s}var pr=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(jc(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ae(this._repo,D())),this._rootInternal}_delete(){return this._rootInternal!==null&&(nd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Le("Cannot call "+e+" on a deleted database.")}};function aa(i=hs(),e){let t=ds(i,"database").getImmediate({identifier:e});if(!t._instanceStarted){let n=Xr("database");n&&rd(t,...n)}return t}function rd(i,e,t,n={}){i=Xe(i),i._checkNotDeleted("useEmulator"),i._instanceStarted&&Le("Cannot call useEmulator() after instance has already been initialized.");let r=i._repoInternal,s;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&Le('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new zt(zt.OWNER);else if(n.mockUserToken){let o=typeof n.mockUserToken=="string"?n.mockUserToken:Jr(n.mockUserToken,i.app.options.projectId);s=new zt(o)}ed(r,e,t,s)}function sd(i){Ta(us),cs(new os("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return td(n,r,s,t)},"PUBLIC").setMultipleInstances(!0)),di(_s,gs,i),di(_s,gs,"esm2017")}gr.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};gr.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};sd();var Nt=(()=>{let e=class e{constructor(){}isLocal(){return location.hostname==="localhost"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ke=(()=>{let e=class e{constructor(n,r,s){this.authService=n,this.envService=r,this.router=s}getCardsLocation(){return this.authService.user+"/cards"}getSetsLocation(){return this.authService.user+"/sets"}getDb(){let n=this.authService.getFirebaseApp();return n||this.router.navigateByUrl("/auth"),n?aa(n):null}getLocalLang(n){return n==="base_lang"?"en":"de"}getLanguage(n){return S(this,null,function*(){if(this.envService.isLocal())return this.getLocalLang(n);let r=this.getDb();if(!r)return null;let s=we(r,this.authService.user+"/"+n);return yield ln(s).then(o=>o.exists()?o.toJSON():null)})}getBaseLanguage(){return S(this,null,function*(){return this.getLanguage("base_lang")})}getGoalLanguage(){return S(this,null,function*(){return this.getLanguage("goal_lang")})}getSettings(){return S(this,null,function*(){let n=this.getDb();if(!n||this.envService.isLocal())return null;let r=we(n,this.authService.user+"/settings");return yield ln(r).then(s=>s.exists()?s.toJSON():null)})}setSettings(n){return S(this,null,function*(){let r=this.getDb();if(!r||this.envService.isLocal())return;let s=we(r,this.authService.user+"/settings");return yield at(s,n)})}getCards(){return S(this,null,function*(){let n=this.getDb();if(!n)return null;let r=we(n,this.getCardsLocation());return yield ln(r).then(s=>s.exists()?s.toJSON():null)})}updateCard(n){return S(this,null,function*(){let r=this.getDb();if(r)return at(we(r,this.getCardsLocation()+"/"+n.id),n)})}addCard(n){return S(this,null,function*(){let r=this.getDb();if(r)return at(we(r,this.getCardsLocation()+"/"+n.id),n)})}deleteCard(n){return S(this,null,function*(){let r=this.getDb();if(r)return Fr(we(r,this.getCardsLocation()+"/"+n))})}getSets(){return S(this,null,function*(){let n=this.getDb();if(!n)return null;let r=we(n,this.getSetsLocation());return yield ln(r).then(s=>s.exists()?s.toJSON():null)})}addSet(n){return S(this,null,function*(){let r=this.getDb();if(r)return at(we(r,this.getSetsLocation()+"/"+n.id),n)})}updateSet(n){return S(this,null,function*(){let r=this.getDb();if(r)return at(we(r,this.getSetsLocation()+"/"+n.id),n)})}deleteSet(n){return S(this,null,function*(){let r=this.getDb();if(r)return Fr(we(r,this.getSetsLocation()+"/"+n))})}};e.\u0275fac=function(r){return new(r||e)(Y(me),Y(Nt),Y(De))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Oe=(()=>{let e=class e{constructor(n,r,s){this.dbService=n,this.envService=r,this.notificationService=s,this.cards=null,this.cardAdded=new z,this.typeOptions=["masculine","feminine","neuter","verb","other"]}loadCards(){return S(this,null,function*(){return this.cards&&this.cards.length>0?this.cards:this.dbService.getCards().then(n=>(this.cards=Object.values(n),this.notificationService.push({message:"Cards loaded!",success:!0}),this.cards))})}getCard(n){let r=this.findCardIndex(n);return r===null||!this.cards?null:this.cards[r]}getCards(){return this.cards?this.cards:[]}getStarred(){return this.cards?this.cards.filter(n=>n.starred):[]}findCardIndex(n){let r=this.getCards(),s=0,o=r.length-1;for(;o>=s;){let a=Math.floor((o+s)/2),l=r[a];if(l.id===n)return a;l.id<n?s=a+1:l.id>n&&(o=a-1)}return this.notificationService.push({message:"Couldn't find card!",success:!1}),null}update(n,r){return S(this,null,function*(){if(this.cards=yield this.loadCards(),this.envService.isLocal()){this.cards[r]=n;return}return this.dbService.updateCard(n).then(()=>{this.cards&&(this.cards[r]=n)})})}add(n){return S(this,null,function*(){if(this.cards=yield this.loadCards(),n.id=this.cards[this.cards.length-1].id+1,this.envService.isLocal()){this.cards.push(n),this.cardAdded.next(n);return}return this.dbService.addCard(n).then(()=>{this.cards?.push(n),this.cardAdded.next(n)})})}delete(n,r){return S(this,null,function*(){if(this.cards=yield this.loadCards(),this.envService.isLocal()){this.cards.splice(r,1);return}return this.dbService.deleteCard(n).then(()=>{this.cards?.splice(r,1)})})}};e.\u0275fac=function(r){return new(r||e)(Y(Ke),Y(Nt),Y(se))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var xe=(()=>{let e=class e{constructor(n,r,s,o){this.cardsService=n,this.dbService=r,this.envService=s,this.notificationService=o,this.updated=new z,this.sets=null,this.colorOptions=["plum","lightgreen","palegoldenrod","lightpink","lightblue"]}parse(n){return Object.values(n).map(r=>(r.cards=r.cards?Object.values(r.cards):[],r))}getNextId(){if(!this.sets||this.sets.length===0)return 0;let n=0;return this.sets.forEach(r=>{r.id>n&&(n=r.id)}),n+1}loadSets(){return S(this,null,function*(){return this.sets?this.sets:this.dbService.getSets().then(n=>(this.sets=n?this.parse(n):[],this.sets.sort((r,s)=>r.name.localeCompare(s.name)),this.sets))})}loadSetFromParams(n){return S(this,null,function*(){let r=n.get("setId");return r===null?null:this.getSet(Number.parseInt(r))})}getSets(){return this.sets?this.sets:[]}getSet(n){return S(this,null,function*(){this.sets||(yield this.loadSets());let r=this.sets?.find(s=>s.id===n);return r||null})}getCards(n){return S(this,null,function*(){let r=yield this.getSet(n);if(!r)return[];let s=[];return r.cards.forEach(o=>{let a=this.cardsService.getCard(o);a!==null&&s.push(a)}),s.sort((o,a)=>o.id-a.id)})}add(n){return S(this,null,function*(){if(this.sets=yield this.loadSets(),!this.sets){this.notificationService.push({message:"Failed to add set!",success:!1});return}return this.sets.sort,n.id=this.getNextId(),this.dbService.addSet(n).then(()=>{this.sets?.push(n)})})}updateSet(n){return S(this,null,function*(){return this.dbService.updateSet(n).then(()=>{this.notificationService.push({message:"Set updated!",success:!0});let r=this.sets?.findIndex(s=>s.id===n.id);r&&this.sets&&(this.sets[r]=n),this.updated.next()}).catch(()=>{this.notificationService.push({message:"Failed to update set!",success:!1})})})}deleteSet(n){return S(this,null,function*(){return this.dbService.deleteSet(n).then(()=>{this.notificationService.push({message:"Set deleted!",success:!0});let r=this.sets?.findIndex(s=>s.id===n);r&&this.sets?.splice(r,1)}).catch(r=>{this.notificationService.push({message:"Failed to delete set!",success:!1})})})}};e.\u0275fac=function(r){return new(r||e)(Y(Oe),Y(Ke),Y(Nt),Y(se))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ft=(()=>{let e=class e{constructor(){this.setSelectOpened=new z,this.setSelectClosed=new z}open(n){this.setSelectOpened.next(n)}close(){this.setSelectClosed.next()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ad=i=>({backgroundColor:i});function ld(i,e){i&1&&(d(0,"div",19),T(),d(1,"svg",7),m(2,"g",8)(3,"g",9),d(4,"g",10),m(5,"path",20)(6,"path",21),f()()())}function cd(i,e){i&1&&(d(0,"div",19),T(),d(1,"svg",7),m(2,"g",8)(3,"g",9),d(4,"g",10),m(5,"path",22),f()()())}function dd(i,e){if(i&1){let t=N();d(0,"div",13)(1,"div",14),y("click",function(){let r=x(t).$implicit,s=_(2);return b(s.toggleSelectionFor(r))}),d(2,"div",15)(3,"div",16),P(4),f(),d(5,"div",17),E(6,ld,7,0,"div",18)(7,cd,6,0,"div",18),f()()()()}if(i&2){let t=e.$implicit,n=_(2);g(),ce(ie(5,ad,t.color)),g(3),ae(" ",t.name," "),g(2),v("ngIf",!t.cards.includes(n.selection)),g(),v("ngIf",t.cards.includes(n.selection))}}function ud(i,e){if(i&1){let t=N();d(0,"app-modal",1),y("close",function(){x(t);let r=_();return b(r.close())}),d(1,"h4",2),P(2,"Add to set(s)"),f(),d(3,"div",3),E(4,dd,8,7,"div",4),f(),d(5,"div",5)(6,"button",6),y("click",function(){x(t);let r=_();return b(r.close())}),T(),d(7,"svg",7),m(8,"g",8)(9,"g",9),d(10,"g",10)(11,"g",11),m(12,"path",12),f()()()(),ee(),d(13,"button",6),y("click",function(){x(t);let r=_();return b(r.close())}),T(),d(14,"svg",7),m(15,"g",8)(16,"g",9),d(17,"g",10)(18,"g",11),m(19,"path",12),f()()()()()()}if(i&2){let t=_();g(4),v("ngForOf",t.sets)}}var la=(()=>{let e=class e{constructor(n,r){this.setsService=n,this.setSelectService=r,this.subs=[],this.open=!1,this.sets=[]}ngOnInit(){this.subs=[this.setSelectService.setSelectOpened.subscribe(n=>this.handleOpen(n)),this.setSelectService.setSelectClosed.subscribe(()=>this.open=!1)]}handleOpen(n){this.open=!0,this.selection=n,this.setsService.loadSets().then(r=>{this.sets=r})}addSelectionTo(n){n.cards.push(this.selection),this.setsService.updateSet(n)}removeSelectionFrom(n){n.cards.splice(n.cards.findIndex(r=>r===this.selection),1),this.setsService.updateSet(n)}toggleSelectionFor(n){n.cards.includes(this.selection)?this.removeSelectionFrom(n):this.addSelectionTo(n)}close(){this.open=!1}ngOnDestroy(){this.subs.forEach(n=>n.unsubscribe())}};e.\u0275fac=function(r){return new(r||e)(M(xe),M(Ft))},e.\u0275cmp=V({type:e,selectors:[["app-set-select"]],standalone:!0,features:[j],decls:1,vars:1,consts:[["class","container",3,"close",4,"ngIf"],[1,"container",3,"close"],[1,"title"],[1,"select-list"],["class","set-row",4,"ngFor","ngForOf"],[1,"bottom-row"],[1,"icon-btn","close",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["id","Menu / Close_LG"],["id","Vector","d","M21 21L12 12M12 12L3 3M12 12L21.0001 3M12 12L3 21.0001","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"set-row"],[1,"list-card",3,"click"],[1,"row-between"],[2,"max-width","75%"],[1,"col-center"],["class","icon-btn","style","width: 2.5rem; height: 2.5rem;",4,"ngIf"],[1,"icon-btn",2,"width","2.5rem","height","2.5rem"],["d","M11 8C11 7.44772 11.4477 7 12 7C12.5523 7 13 7.44772 13 8V11H16C16.5523 11 17 11.4477 17 12C17 12.5523 16.5523 13 16 13H13V16C13 16.5523 12.5523 17 12 17C11.4477 17 11 16.5523 11 16V13H8C7.44771 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11H11V8Z","fill","#0F0F0F"],["fill-rule","evenodd","clip-rule","evenodd","d","M23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12ZM3.00683 12C3.00683 16.9668 7.03321 20.9932 12 20.9932C16.9668 20.9932 20.9932 16.9668 20.9932 12C20.9932 7.03321 16.9668 3.00683 12 3.00683C7.03321 3.00683 3.00683 7.03321 3.00683 12Z","fill","#0F0F0F"],["d","M4 12.6111L8.92308 17.5L20 6.5","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"]],template:function(r,s){r&1&&E(0,ud,20,1,"app-modal",0),r&2&&v("ngIf",s.open)},dependencies:[X,Z,fe,gt],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.title[_ngcontent-%COMP%]{margin:.5rem 0 1rem}.select-list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;gap:.5rem;padding:2px}.bottom-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;margin:.25rem 0 -.5rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem}"]});let i=e;return i})();var ca=Je("drop",[Ce("active",ge({top:"0"})),Ce("inactive",ge({top:"-100%"})),ve("active => inactive",_e("200ms ease-out")),ve("inactive => active",_e("200ms ease-in"))]);var hd=i=>({background:i}),da=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=V({type:e,selectors:[["app-action-slider"]],inputs:{active:"active"},standalone:!0,features:[j],decls:2,vars:5,consts:[[1,"track",3,"ngStyle"]],template:function(r,s){r&1&&(d(0,"div",0),m(1,"div"),f()),r&2&&(v("ngStyle",ie(3,hd,s.active?"lightgreen":"gray")),g(),Fe(s.active?"slider right":"slider left"))},dependencies:[zr],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding:4px;margin-right:4px}.track[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;border-radius:2rem;width:42px;height:24px;box-shadow:0 1px 1px gray}.slider[_ngcontent-%COMP%]{border-radius:2rem;width:18px;height:18px;background:#dedede;box-shadow:1px 1px 2px #00000070}.left[_ngcontent-%COMP%]{transition:all .3s ease;margin-left:4px}.right[_ngcontent-%COMP%]{transition:all .3s ease;margin-left:20px}"]});let i=e;return i})();var ti=(()=>{let e=class e{constructor(){this.selected=!1}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=V({type:e,selectors:[["app-color-choice"]],inputs:{value:"value",selected:"selected"},standalone:!0,features:[j],decls:1,vars:4,template:function(r,s){r&1&&m(0,"div"),r&2&&(Fe(s.selected?"choice selected":"choice"),ut("background-color",s.value))},styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.choice[_ngcontent-%COMP%]{width:4rem;height:3rem;border-radius:10px;box-shadow:0 1px 2px gray}.choice[_ngcontent-%COMP%]:hover{cursor:pointer}.selected[_ngcontent-%COMP%]{outline:2px solid black}"]});let i=e;return i})();var $e=(()=>{let e=class e{transform(n){switch(n){case"masculine":return"lightblue";case"feminine":return"lightpink";case"neuter":return"palegoldenrod";case"verb":return"plum";case"other":return"lightgreen";default:return"gray"}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=hn({name:"typeColor",type:e,pure:!0,standalone:!0});let i=e;return i})();var ni=(()=>{let e=class e{constructor(n){this.dbService=n}getBase(){return S(this,null,function*(){if(this.base)return this.base;let n=yield this.dbService.getBaseLanguage();return typeof n=="string"?(this.base=n,n):""})}getGoal(){return S(this,null,function*(){if(this.goal)return this.goal;let n=yield this.dbService.getGoalLanguage();return typeof n=="string"?(this.goal=n,n):""})}};e.\u0275fac=function(r){return new(r||e)(Y(Ke))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ii=(()=>{let e=class e{constructor(n){this.languageService=n}name(n){switch(n){case"en":return"English";case"es":return"Spanish";case"de":return"German";default:return"Unknown"}}transform(n){return S(this,null,function*(){switch(n){case"base":{let r=this.name(yield this.languageService.getBase());return r==="Unknown"?"Base":r}case"goal":{let r=this.name(yield this.languageService.getGoal());return r==="Unknown"?"Goal":r}default:return"Unknown"}})}};e.\u0275fac=function(r){return new(r||e)(M(ni,16))},e.\u0275pipe=hn({name:"language",type:e,pure:!0,standalone:!0});let i=e;return i})();var ha=(()=>{let e=class e{constructor(n,r,s){this.http=n,this.languageService=r,this.notificationsService=s,this.primaryUrlBase="https://lingueeni.duckdns.org/api/v2",this.secondaryUrlBase="https://lingueeni.onrender.com/api/v2",this.loaded=!1}load(){return S(this,null,function*(){try{let n=!!(yield ai(this.http.get(`${this.primaryUrlBase}/translations?query=hello&src=en&dst=de`)));return n?this.notificationsService.push({message:"Linguee loaded!",success:!0}):this.notificationsService.push({message:"Couldn't load Linguee!",success:!1}),n}catch{return this.notificationsService.push({message:"Couldn't load Linguee!",success:!1}),!1}})}getTranslationFromBase(n){return S(this,null,function*(){let r=yield this.languageService.getBase(),s=yield this.languageService.getGoal();return this.getTranslation(n,r,s)})}getTranslationFromGoal(n){return S(this,null,function*(){let r=yield this.languageService.getGoal(),s=yield this.languageService.getBase();return this.getTranslation(n,r,s)})}getTranslation(n,r,s){return S(this,null,function*(){let o=new URLSearchParams({query:n,src:r,dst:s}).toString(),a=yield ai(this.http.get(`${this.primaryUrlBase}/translations?${o}`));return this.notificationsService.push({message:"Translation loaded!",success:!0}),this.pickTranslation(a)})}pickTranslation(n){let r=n.filter(o=>o.featured&&o.translations.length).map(o=>o.translations).flat(),s=r.filter(o=>o.examples.length);return s.length?s[0]:r.length?r[0]:null}};e.\u0275fac=function(r){return new(r||e)(Y(qr),Y(ni),Y(se))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ne=(()=>{let e=class e{constructor(){this.settingsOpen=new z,this.addCardOpen=new z,this.addSetOpen=new z}openSettings(){this.settingsOpen.next(!0)}closeSettings(){this.settingsOpen.next(!1)}openAddCard(){this.addCardOpen.next(!0)}closeAddCard(){this.addCardOpen.next(!1)}openAddSet(){this.addSetOpen.next(!0)}closeAddSet(){this.addSetOpen.next(!1)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Lt=(()=>{let e=class e{constructor(n,r){this.dbService=n,this.notificationsService=r,this.settings={base_front:!0,deal_starred:!1,deck_size:10},this.loading=!0,this.loaded=new z,this.dealStarredChanged=new z,this.dbService.getSettings().then(s=>{this.loading=!1,this.loaded.next(),s&&(this.settings=s)})}update(n){return S(this,null,function*(){return this.dbService.setSettings(n).then(()=>{this.settings=n,this.notificationsService.push({message:"Settings updated!",success:!0})}).catch(()=>{this.notificationsService.push({message:"Failed to update settings!",success:!1})})})}getDealStarred(){return this.settings.deal_starred}setDealStarred(n){let r=ct(Re({},this.settings),{deal_starred:n});this.update(r).then(()=>this.dealStarredChanged.next())}getBaseFront(){return this.settings.base_front}setBaseFront(n){let r=ct(Re({},this.settings),{base_front:n});this.update(r)}getDeckSize(){return this.settings.deck_size}setDeckSize(n){let r=ct(Re({},this.settings),{deck_size:n});this.update(r)}};e.\u0275fac=function(r){return new(r||e)(Y(Ke),Y(se))},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function fd(i,e){if(i&1){let t=N();d(0,"form",1)(1,"div",12)(2,"p",13),P(3,"Deal from starred cards only?"),f(),d(4,"app-action-slider",14),y("click",function(){x(t);let r=_();return b(r.toggleDealFromStarred())}),f()(),d(5,"div",12)(6,"p",13),P(7),L(8,"language"),L(9,"async"),f(),d(10,"app-action-slider",14),y("click",function(){x(t);let r=_();return b(r.toggleBaseFront())}),f()(),d(11,"div",12),m(12,"input",15),d(13,"button",16),y("click",function(){x(t);let r=_();return b(r.setDeckSize())}),P(14,"Set deck size"),f()()()}if(i&2){let t=_();v("formGroup",t.settingsForm),g(4),v("active",t.getDealFromStarred()),g(3),ae("",A(9,6,A(8,4,"base"))," on front?"),g(3),v("active",t.getBaseFront())}}function md(i,e){if(i&1){let t=N();d(0,"button",27),y("click",function(){x(t);let r=_(2);return b(r.searchBase())}),T(),d(1,"svg",28),m(2,"g",6)(3,"g",7),d(4,"g",8)(5,"g"),m(6,"path",29)(7,"path",30)(8,"path",31)(9,"path",32)(10,"path",33)(11,"path",34)(12,"path",35)(13,"path",36)(14,"path",37)(15,"path",38),f()()()()}}function _d(i,e){if(i&1){let t=N();d(0,"button",27),y("click",function(){x(t);let r=_(2);return b(r.searchGoal())}),T(),d(1,"svg",28),m(2,"g",6)(3,"g",7),d(4,"g",8)(5,"g"),m(6,"path",29)(7,"path",30)(8,"path",31)(9,"path",32)(10,"path",33)(11,"path",34)(12,"path",35)(13,"path",36)(14,"path",37)(15,"path",38),f()()()()}}function gd(i,e){if(i&1&&(d(0,"option",39),L(1,"typeColor"),P(2),f()),i&2){let t=e.$implicit;ut("background",A(1,4,t)),v("ngValue",t),g(2),pe(t)}}function Cd(i,e){if(i&1&&(d(0,"form",2)(1,"h2"),P(2,"Add card"),f(),d(3,"div",17),m(4,"input",18),L(5,"language"),L(6,"async"),E(7,md,16,0,"button",19),f(),d(8,"div",17),m(9,"input",20),L(10,"language"),L(11,"async"),E(12,_d,16,0,"button",19),f(),d(13,"select",21),E(14,gd,3,6,"option",22),f(),m(15,"textarea",23),L(16,"language"),L(17,"async"),m(18,"textarea",24),L(19,"language"),L(20,"async"),m(21,"textarea",25),L(22,"language"),L(23,"async"),m(24,"textarea",26),L(25,"language"),L(26,"async"),f()),i&2){let t=_();v("formGroup",t.addCardForm),g(4),v("placeholder",A(6,12,A(5,10,"base"))),g(3),v("ngIf",t.lingueeniLoaded),g(2),v("placeholder",A(11,16,A(10,14,"goal"))),g(3),v("ngIf",t.lingueeniLoaded),g(2),v("ngForOf",t.typeOptions),g(),v("placeholder",A(17,20,A(16,18,"goal"))+" sentence 1"),g(3),v("placeholder",A(20,24,A(19,22,"base"))+" sentence 1"),g(3),v("placeholder",A(23,28,A(22,26,"goal"))+" sentence 2"),g(3),v("placeholder",A(26,32,A(25,30,"base"))+" sentence 2")}}function vd(i,e){if(i&1){let t=N();d(0,"app-color-choice",43),y("click",function(){let r=x(t).$implicit,s=_(2);return b(s.addSetForm.patchValue({color:r}))}),f()}if(i&2){let t,n=e.$implicit,r=_(2);v("value",n)("selected",((t=r.addSetForm.get("color"))==null?null:t.value)===n)}}function yd(i,e){if(i&1&&(d(0,"form",2)(1,"h2"),P(2,"Add set"),f(),m(3,"input",40),d(4,"div",41),E(5,vd,1,2,"app-color-choice",42),f()()),i&2){let t=_();v("formGroup",t.addSetForm),g(5),v("ngForOf",t.getColorOptions())}}function wd(i,e){if(i&1){let t=N();d(0,"button",4),y("click",function(){x(t);let r=_();return b(r.save())}),T(),d(1,"svg",5),m(2,"g",6)(3,"g",7),d(4,"g",8),m(5,"path",44),f()()()}}var pa=(()=>{let e=class e{constructor(n,r,s,o,a,l){this.cardsService=n,this.lingueeniService=r,this.menuService=s,this.notificationsService=o,this.setsService=a,this.settingsService=l,this.subs=[],this.dropState="inactive",this.settingsOpen=!1,this.addCardOpen=!1,this.addSetOpen=!1,this.lingueeniLoaded=!1,this.settingsForm=new Ge({deckSize:new W(this.settingsService.getDeckSize(),[re.min(1),re.required])}),this.addCardForm=new Ge({base:new W("",[re.required,re.minLength(1)]),goal:new W("",re.required),type:new W("masculine",re.required),goal_sent_1:new W(""),base_sent_1:new W(""),goal_sent_2:new W(""),base_sent_2:new W("")}),this.addSetForm=new Ge({name:new W(null,re.required),color:new W(null,re.required)})}ngOnInit(){return S(this,null,function*(){this.subs=[this.menuService.settingsOpen.subscribe(n=>this.settingsOpen=n),this.menuService.addCardOpen.subscribe(n=>this.addCardOpen=n),this.menuService.addSetOpen.subscribe(n=>this.addSetOpen=n),this.settingsService.loaded.subscribe(()=>{this.settingsForm.patchValue({deckSize:this.settingsService.getDeckSize()})})],this.typeOptions=this.cardsService.typeOptions,this.lingueeniLoaded=yield this.lingueeniService.load()})}resetAddForm(){this.addCardForm.reset(),this.addCardForm.patchValue({type:"masculine"})}close(){this.addCardOpen&&this.resetAddForm(),this.addSetOpen&&this.addSetForm.reset(),this.menuService.closeSettings(),this.menuService.closeAddCard(),this.menuService.closeAddSet()}searchBase(){return S(this,null,function*(){let n=this.addCardForm.get("base")?.value;if(!n)return;let r=yield this.lingueeniService.getTranslationFromBase(n);if(!r)return;this.addCardForm.patchValue({goal:r.text});let s=r.examples.length;this.addCardForm.patchValue({goal_sent_1:s?r.examples[0].dst:"",base_sent_1:s?r.examples[0].src:"",goal_sent_2:s>1?r.examples[1].dst:"",base_sent_2:s>1?r.examples[1].src:""})})}searchGoal(){return S(this,null,function*(){let n=this.addCardForm.get("goal")?.value;if(!n)return;let r=yield this.lingueeniService.getTranslationFromGoal(n);if(!r)return;this.addCardForm.patchValue({base:r.text});let s=r.examples.length;this.addCardForm.patchValue({goal_sent_1:s?r.examples[0].src:"",base_sent_1:s?r.examples[0].dst:"",goal_sent_2:s>1?r.examples[1].src:"",base_sent_2:s>1?r.examples[1].dst:""})})}save(){this.addCardOpen?this.addCard():this.addSetOpen&&this.addSet()}addCard(){let n={id:-1,base:this.addCardForm.controls.base.value?this.addCardForm.controls.base.value:"",goal:this.addCardForm.controls.goal.value?this.addCardForm.controls.goal.value:"",type:this.addCardForm.controls.type.value?this.addCardForm.controls.type.value:"other",goal_sent_1:this.addCardForm.controls.goal_sent_1.value?this.addCardForm.controls.goal_sent_1.value:"",base_sent_1:this.addCardForm.controls.base_sent_1.value?this.addCardForm.controls.base_sent_1.value:"",goal_sent_2:this.addCardForm.controls.goal_sent_2.value?this.addCardForm.controls.goal_sent_2.value:"",base_sent_2:this.addCardForm.controls.base_sent_2.value?this.addCardForm.controls.base_sent_2.value:"",starred:!1};this.cardsService.add(n).then(()=>{this.close(),this.notificationsService.push({message:"Card added!",success:!0})}).catch(r=>{this.notificationsService.push({message:"Error adding card to db! "+r,success:!1})})}getColorOptions(){return this.setsService.colorOptions}addSet(){let n=this.addSetForm.value,r={id:-1,name:n.name?n.name:"",color:n.color?n.color:"lightgray",cards:[]};this.setsService.add(r).then(()=>this.close())}getDropState(){return this.settingsOpen||this.addCardOpen||this.addSetOpen?"active":"inactive"}getDealFromStarred(){return this.settingsService.getDealStarred()}toggleDealFromStarred(){this.settingsService.setDealStarred(!this.settingsService.getDealStarred())}getBaseFront(){return this.settingsService.getBaseFront()}toggleBaseFront(){this.settingsService.setBaseFront(!this.settingsService.getBaseFront())}setDeckSize(){let n=this.settingsForm.controls.deckSize.value;n&&this.settingsService.setDeckSize(n)}ngOnDestroy(){this.subs.forEach(n=>n.unsubscribe())}};e.\u0275fac=function(r){return new(r||e)(M(Oe),M(ha),M(Ne),M(se),M(xe),M(Lt))},e.\u0275cmp=V({type:e,selectors:[["app-menu"]],standalone:!0,features:[j],decls:20,vars:3,consts:[[1,"menu-container"],[3,"formGroup"],[1,"add-form",3,"formGroup"],[1,"navbar"],[1,"icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["id","Menu / Close_LG"],["id","Vector","d","M21 21L12 12M12 12L3 3M12 12L21.0001 3M12 12L3 21.0001","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["class","icon-btn",3,"click",4,"ngIf"],[1,"row"],[1,"label",2,"margin-right","1rem"],[3,"click","active"],["type","number","placeholder","deck size","formControlName","deckSize",2,"margin","0"],[1,"btn",2,"margin","0",3,"click"],[1,"inp-row"],["type","text","formControlName","base",1,"border-input",2,"width","100%","margin-right","0",3,"placeholder"],["class","icon-btn","style","margin-top: -0.5rem;","title","Lookup on Linguee",3,"click",4,"ngIf"],["type","text","formControlName","goal",1,"border-input",2,"width","100%","margin-right","0",3,"placeholder"],["formControlName","type",1,"border-input"],[3,"ngValue","background",4,"ngFor","ngForOf"],["type","text","formControlName","goal_sent_1",1,"border-input",3,"placeholder"],["type","text","formControlName","base_sent_1",1,"border-input",3,"placeholder"],["type","text","formControlName","goal_sent_2",1,"border-input",3,"placeholder"],["type","text","formControlName","base_sent_2",1,"border-input",3,"placeholder"],["title","Lookup on Linguee",1,"icon-btn",2,"margin-top","-0.5rem",3,"click"],["fill","#000000","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","viewBox","0 0 338.364 338.364",0,"xml","space","preserve"],["d","M332.201,55.344c-2.964-1.232-73.148-30.162-121.749-30.162c-21.234,0-33.858,5.597-41.27,13.045 c-7.412-7.448-20.036-13.045-41.269-13.045c-48.602,0-118.786,28.93-121.75,30.162C2.432,56.894,0,60.538,0,64.579v238.604 c0,3.339,1.666,6.457,4.442,8.314c1.669,1.115,3.607,1.686,5.559,1.686c1.293,0,2.592-0.251,3.821-0.76 c0.888-0.367,89.31-36.731,132.189-36.731c9.963,0,14.035,2.104,14.871,3.349c2.454,3.652,7.005,5.273,11.216,3.988 c2.344-0.714,4.272-2.236,5.523-4.203c0.004,0.01,0.009,0.018,0.014,0.027c1.099-1.257,5.238-3.161,14.72-3.161 c42.878,0,131.3,36.364,132.188,36.731c1.229,0.509,2.528,0.76,3.821,0.76c1.951,0,3.889-0.571,5.559-1.686 c2.776-1.857,4.442-4.975,4.442-8.314V64.579C338.364,60.538,335.933,56.894,332.201,55.344z M318.364,288.465 c-27.588-10.607-89.6-32.774-126.01-32.774c-4.912,0-9.297,0.393-13.171,1.184v-43.537c-7.019-0.832-13.766-2.858-20-5.985v49.522 c-3.874-0.791-8.259-1.184-13.171-1.184c-36.411,0-98.423,22.167-126.011,32.774V71.372c17.94-6.927,71.149-26.19,107.913-26.19 c31.269,0,31.269,13.592,31.269,19.397v33.713c6.235-3.128,12.98-5.156,20-5.986V64.579c0-5.805,0-19.397,31.27-19.397 c36.764,0,89.972,19.264,107.912,26.19V288.465z"],["d","M46.871,117.682c1.169,0,2.357-0.274,3.466-0.854c13.884-7.249,54.114-23.65,73.292-12.643 c3.591,2.063,8.176,0.822,10.238-2.771c2.062-3.592,0.822-8.176-2.771-10.238C118.038,83.68,99.102,83.6,74.817,90.94 c-17.231,5.208-30.861,12.298-31.433,12.597c-3.669,1.92-5.085,6.449-3.167,10.119C41.556,116.216,44.167,117.682,46.871,117.682z"],["d","M46.871,157.682c1.169,0,2.357-0.274,3.466-0.854c13.884-7.249,54.114-23.65,73.292-12.643 c0.771,0.443,1.589,0.725,2.416,0.872c0.63-4.965,1.862-9.867,3.711-14.583c-13.001-6.771-31.462-6.631-54.938,0.465 c-17.231,5.208-30.861,12.298-31.433,12.597c-3.669,1.92-5.085,6.449-3.167,10.119C41.556,156.216,44.167,157.682,46.871,157.682z"],["d","M46.871,197.682c1.169,0,2.357-0.274,3.466-0.854c13.884-7.249,54.114-23.653,73.292-12.642 c1.934,1.11,4.154,1.255,6.115,0.599l3.064-3.064c-2.097-3.897-3.729-7.979-4.917-12.161c-12.88-5.83-30.7-5.382-53.073,1.379 c-17.231,5.208-30.861,12.298-31.433,12.598c-3.669,1.92-5.085,6.448-3.167,10.118C41.556,196.217,44.167,197.682,46.871,197.682z"],["d","M74.817,210.94c-17.231,5.208-30.861,12.298-31.433,12.598c-3.669,1.92-5.085,6.448-3.167,10.118 c1.339,2.562,3.95,4.026,6.654,4.026c1.169,0,2.357-0.274,3.466-0.854c8.472-4.423,26.75-12.245,44.072-15.178 c0.841-1.816,1.991-3.523,3.488-5.021l11.082-11.081C99.157,205.248,87.754,207.031,74.817,210.94z"],["d","M204.227,94.474c5.616,1.702,10.95,4.219,15.863,7.482c20.512-6.03,55.24,8.242,67.938,14.872 c1.109,0.58,2.297,0.854,3.468,0.854c2.702,0,5.312-1.464,6.651-4.024c1.92-3.67,0.503-8.202-3.168-10.123 c-0.572-0.299-14.202-7.389-31.433-12.597c-24.284-7.339-43.219-7.26-56.279,0.237C205.889,91.97,204.859,93.136,204.227,94.474z"],["d","M294.98,143.537c-0.572-0.299-14.202-7.389-31.433-12.597c-8.016-2.422-15.436-4.02-22.268-4.825 c2.463,5.046,4.207,10.418,5.189,15.994c16.55,3.223,33.497,10.51,41.559,14.72c1.109,0.58,2.297,0.854,3.468,0.854 c2.702,0,5.312-1.464,6.651-4.023C300.068,149.99,298.65,145.457,294.98,143.537z"],["d","M294.98,183.538c-0.572-0.3-14.202-7.39-31.433-12.598c-6.274-1.896-12.184-3.287-17.735-4.192 c-1.167,5.013-2.957,9.838-5.343,14.377c18.299,2.386,38.517,10.983,47.559,15.704c1.109,0.58,2.297,0.855,3.468,0.855 c2.702,0,5.312-1.465,6.651-4.025C300.068,189.99,298.65,185.457,294.98,183.538z"],["d","M294.98,223.538c-0.572-0.3-14.202-7.39-31.433-12.598c-24.284-7.34-43.219-7.26-56.279,0.237 c-3.592,2.063-4.833,6.646-2.771,10.239c2.064,3.593,6.648,4.83,10.238,2.771c19.176-11.009,59.408,5.393,73.292,12.642 c1.109,0.58,2.297,0.855,3.468,0.855c2.702,0,5.312-1.465,6.651-4.025C300.068,229.99,298.65,225.457,294.98,223.538z"],["d","M236.506,152.815c0-13.61-5.301-26.407-14.925-36.031c-9.624-9.624-22.419-14.925-36.03-14.925 c-13.611,0-26.407,5.301-36.031,14.925c-9.624,9.624-14.925,22.421-14.925,36.031c0,11.077,3.512,21.613,10.007,30.342 l-40.547,40.545c-2.929,2.929-2.929,7.678,0,10.606c1.464,1.465,3.384,2.197,5.303,2.197c1.919,0,3.839-0.732,5.303-2.196 l40.547-40.546c8.727,6.495,19.265,10.007,30.342,10.007c13.61,0,26.406-5.3,36.029-14.924 C231.205,179.221,236.506,166.425,236.506,152.815z M210.974,178.24c-6.79,6.791-15.819,10.53-25.422,10.53 c-9.604,0-18.633-3.739-25.425-10.531c-6.791-6.791-10.531-15.82-10.531-25.424c0-9.605,3.74-18.633,10.531-25.425 c6.792-6.791,15.821-10.531,25.425-10.531c9.604,0,18.632,3.74,25.423,10.532c6.791,6.791,10.532,15.82,10.532,25.424 S217.766,171.448,210.974,178.24z"],[3,"ngValue"],["type","text","formControlName","name","placeholder","Name",1,"border-input"],[1,"color-container"],[3,"value","selected","click",4,"ngFor","ngForOf"],[3,"click","value","selected"],["fill-rule","evenodd","clip-rule","evenodd","d","M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z","fill","#0F0F0F"]],template:function(r,s){r&1&&(d(0,"div",0),E(1,fd,15,8,"form",1)(2,Cd,27,34,"form",2)(3,yd,6,2,"form",2),d(4,"div",3)(5,"button",4),y("click",function(){return s.close()}),T(),d(6,"svg",5),m(7,"g",6)(8,"g",7),d(9,"g",8)(10,"g",9),m(11,"path",10),f()()()(),E(12,wd,6,0,"button",11),ee(),d(13,"button",4),y("click",function(){return s.close()}),T(),d(14,"svg",5),m(15,"g",6)(16,"g",7),d(17,"g",8)(18,"g",9),m(19,"path",10),f()()()()()()),r&2&&(v("@drop",s.getDropState()),g(),ne(s.settingsOpen?1:s.addCardOpen?2:s.addSetOpen?3:-1),g(11),v("ngIf",s.addCardOpen&&s.addCardForm.valid||s.addSetOpen&&s.addSetForm.valid))},dependencies:[X,Z,fe,_n,Be,ft,xn,bn,Ve,ps,wn,je,pt,mt,_t,da,ti,$e,ii],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.menu-container[_ngcontent-%COMP%]{position:absolute;left:0;display:flex;flex-direction:column;justify-content:flex-end;width:100%;height:100%;background:#dedede;z-index:1}.row[_ngcontent-%COMP%]{margin:0 1rem;display:flex;flex-direction:row;justify-content:space-between}.inp-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:.5rem;margin-right:.5rem}.add-form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;justify-content:flex-end;margin:1rem 0;text-align:center;gap:.5rem}"],data:{animation:[ca]}});let i=e;return i})();var ri=(()=>{let e=class e{constructor(){this.undos=[],this.redos=[],this.activeUndo=new z,this.activeRedo=new z}pushUndo(n){this.undos.push(n)}pushRedo(n){this.redos.push(n)}applyUndo(){let n=this.undos.pop();n&&(this.redos.push(n),this.activeUndo.next(n))}applyRedo(){let n=this.redos.pop();n&&(this.undos.push(n),this.activeRedo.next(n))}reset(){this.resetUndos(),this.resetRedos()}resetUndos(){this.undos=[]}resetRedos(){this.redos=[]}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ma=(()=>{let e=class e{constructor(n){this.actionsService=n,this.listOpen=!1,this.listExpanded=!1,this.query=new z}ngOnInit(){}toggleList(){this.listOpen=!this.listOpen}handleBack(){this.listExpanded?this.listExpanded=!1:this.listOpen=!1}handleUndo(){this.actionsService.applyUndo()}handleRedo(){this.actionsService.applyRedo()}handleSearch(n){this.query.next(n)}};e.\u0275fac=function(r){return new(r||e)(M(ri))},e.\u0275cmp=V({type:e,selectors:[["app-layout"]],standalone:!0,features:[j],decls:5,vars:0,consts:[[1,"content"]],template:function(r,s){r&1&&(d(0,"div",0),m(1,"app-notifications")(2,"app-set-select")(3,"app-menu")(4,"router-outlet"),f())},dependencies:[Yr,ms,la,pa],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.content[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;display:flex;flex-direction:column;justify-content:space-between}"]});let i=e;return i})();var xd=["*"],Qe=(()=>{let e=class e{constructor(n){this.menuService=n}ngOnInit(){}settingsPressed(){this.menuService.openSettings()}};e.\u0275fac=function(r){return new(r||e)(M(Ne))},e.\u0275cmp=V({type:e,selectors:[["app-navbar"]],standalone:!0,features:[j],ngContentSelectors:xd,decls:13,vars:0,consts:[[1,"navbar"],["title","Settings",1,"icon-btn",3,"click"],["viewBox","-0.5 0 25 25","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M12 7.82001H22","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M2 7.82001H4","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M20 16.82H22","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M2 16.82H12","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M8 11.82C10.2091 11.82 12 10.0291 12 7.82001C12 5.61087 10.2091 3.82001 8 3.82001C5.79086 3.82001 4 5.61087 4 7.82001C4 10.0291 5.79086 11.82 8 11.82Z","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["d","M16 20.82C18.2091 20.82 20 19.0291 20 16.82C20 14.6109 18.2091 12.82 16 12.82C13.7909 12.82 12 14.6109 12 16.82C12 19.0291 13.7909 20.82 16 20.82Z","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"]],template:function(r,s){r&1&&(fn(),d(0,"div",0),mn(1),d(2,"button",1),y("click",function(){return s.settingsPressed()}),T(),d(3,"svg",2),m(4,"g",3)(5,"g",4),d(6,"g",5),m(7,"path",6)(8,"path",7)(9,"path",8)(10,"path",9)(11,"path",10)(12,"path",11),f()()()())},styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.navbar[_ngcontent-%COMP%]{border-radius:10px 10px 0 0;border-bottom:none;box-shadow:0 2px 4px #000;padding-top:.5rem}"]});let i=e;return i})();var bd=i=>({background:i});function Sd(i,e){if(i&1&&(d(0,"a",14),P(1),f()),i&2){let t=e.$implicit;ce(ie(4,bd,t.color)),v("routerLink",t.link),g(),pe(t.link)}}var _a=(()=>{let e=class e{constructor(n,r){this.authService=n,this.menuService=r,this.menuOptions=[{link:"list",color:"lightgreen"},{link:"deck",color:"plum"},{link:"sets",color:"palegoldenrod"}]}logout(){this.authService.signOut(),window.location.reload()}addPressed(){this.menuService.openAddCard()}};e.\u0275fac=function(r){return new(r||e)(M(me),M(Ne))},e.\u0275cmp=V({type:e,selectors:[["app-landing"]],standalone:!0,features:[j],decls:18,vars:1,consts:[[1,"wrapper"],["class","menu-card",3,"routerLink","style",4,"ngFor","ngForOf"],["title","Logout",1,"icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg","transform","rotate(180)"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M21 12L13 12","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M18 15L20.913 12.087V12.087C20.961 12.039 20.961 11.961 20.913 11.913V11.913L18 9","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M16 5V4.5V4.5C16 3.67157 15.3284 3 14.5 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H14.5C15.3284 21 16 20.3284 16 19.5V19.5V19","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["title","Add",1,"icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M11 8C11 7.44772 11.4477 7 12 7C12.5523 7 13 7.44772 13 8V11H16C16.5523 11 17 11.4477 17 12C17 12.5523 16.5523 13 16 13H13V16C13 16.5523 12.5523 17 12 17C11.4477 17 11 16.5523 11 16V13H8C7.44771 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11H11V8Z","fill","#0F0F0F"],["fill-rule","evenodd","clip-rule","evenodd","d","M23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12ZM3.00683 12C3.00683 16.9668 7.03321 20.9932 12 20.9932C16.9668 20.9932 20.9932 16.9668 20.9932 12C20.9932 7.03321 16.9668 3.00683 12 3.00683C7.03321 3.00683 3.00683 7.03321 3.00683 12Z","fill","#0F0F0F"],[1,"menu-card",3,"routerLink"]],template:function(r,s){r&1&&(d(0,"div",0),E(1,Sd,2,6,"a",1),f(),d(2,"app-navbar")(3,"button",2),y("click",function(){return s.logout()}),T(),d(4,"svg",3),m(5,"g",4)(6,"g",5),d(7,"g",6),m(8,"path",7)(9,"path",8)(10,"path",9),f()()(),ee(),d(11,"button",10),y("click",function(){return s.addPressed()}),T(),d(12,"svg",11),m(13,"g",4)(14,"g",5),d(15,"g",6),m(16,"path",12)(17,"path",13),f()()()()),r&2&&(g(),v("ngForOf",s.menuOptions))},dependencies:[X,Z,Kr,Qe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;margin:auto;width:100%;height:100%}.wrapper[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;margin:1rem;gap:.5rem}.menu-card[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;display:flex;flex-direction:column;justify-content:center;border-radius:10px;box-shadow:0 1px 2px gray;text-decoration:none;color:#000;font-size:28px}"]});let i=e;return i})();var At=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=V({type:e,selectors:[["app-loading"]],standalone:!0,features:[j],decls:2,vars:0,consts:[[1,"loading-container"],[1,"spinner"]],template:function(r,s){r&1&&(d(0,"div",0),m(1,"div",1),f())},styles:[".loading-container[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;top:25%;display:flex;flex-direction:row;justify-content:center}.spinner[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:100%;animation:_ngcontent-%COMP%_morph 1s alternate infinite}@keyframes _ngcontent-%COMP%_morph{0%{background:plum;border-radius:50%;margin-top:0}to{background:#90ee90;border-radius:100%;margin-top:2rem}}"]});let i=e;return i})();var ga=Je("flip",[Ce("active",ge({transform:"rotateY(180deg)"})),Ce("inactive",ge({transform:"rotateY(0)"})),ve("active => inactive",_e("300ms ease-out")),ve("inactive => active",_e("300ms ease-in"))]),Ca=Je("swipeRight",[Ce("active",ge({transform:"rotateZ(90deg)",translate:"150% -100%"})),Ce("inactive",ge({transform:"rotateZ(0deg)",translate:"0% 0%"})),ve("active => inactive",_e("300ms ease-out")),ve("inactive => active",_e("300ms ease-in"))]),va=Je("swipeLeft",[Ce("active",ge({transform:"rotateZ(-90deg)",translate:"-150% -100%"})),Ce("inactive",ge({transform:"rotateZ(0deg)",translate:"0% 0%"})),ve("active => inactive",_e("400ms ease-out")),ve("inactive => active",_e("400ms ease-in"))]),ya=Je("fadeIn",[Ce("active",ge({opacity:"100%"})),Ce("inactive",ge({opacity:"0%"})),ve("active => inactive",_e("200ms ease-out")),ve("inactive => active",_e("200ms ease-in"))]);var kd=i=>({background:i});function Md(i,e){if(i&1){let t=N();d(0,"app-modal"),P(1," Delete card? "),d(2,"div",3)(3,"button",4),y("click",function(r){x(t);let s=_();return b(s.delete(r))}),P(4,"yes"),f(),d(5,"button",5),y("click",function(){x(t);let r=_();return b(r.showDelete=!1)}),P(6,"no"),f()()()}}function Td(i,e){if(i&1&&(d(0,"div"),P(1),f()),i&2){let t=_();Fe(t.flipped?"card-content":"card-content back"),g(),ae(" ",t.flipped?t.getFront():t.getBack()," ")}}function Ed(i,e){i&1&&(T(),d(0,"svg",14),m(1,"g",8)(2,"g",9),d(3,"g",10),m(4,"path",20),f()())}function Pd(i,e){i&1&&(T(),d(0,"svg",15),m(1,"g",8)(2,"g",9),d(3,"g",10),m(4,"path",21),f()())}function Id(i,e){if(i&1){let t=N();d(0,"div")(1,"button",6),y("click",function(r){x(t);let s=_();return b(s.editTapped(r))}),T(),d(2,"svg",7),m(3,"g",8)(4,"g",9),d(5,"g",10),m(6,"path",11)(7,"path",12),f()()(),ee(),d(8,"button",13),y("click",function(r){x(t);let s=_();return b(s.starTapped(r,s.card))}),E(9,Ed,5,0,":svg:svg",14)(10,Pd,5,0,":svg:svg",15),f(),d(11,"button",6),y("click",function(r){x(t);let s=_();return b(s.infoTapped(r))}),T(),d(12,"svg",16),m(13,"g",8)(14,"g",9),d(15,"g",10),m(16,"path",17)(17,"path",18)(18,"path",19),f()()()()}if(i&2){let t=_();Fe(t.flipped?"btn-row":"btn-row back"),g(9),ne(t.card.starred?9:10)}}function Od(i,e){if(i&1&&(d(0,"option",32),L(1,"typeColor"),P(2),f()),i&2){let t=e.$implicit,n=_(3);ut("background",A(1,4,t)),v("selected",t===n.card.type),g(2),pe(t)}}function Nd(i,e){if(i&1&&(d(0,"div")(1,"form",23),m(2,"input",24),L(3,"language"),L(4,"async"),m(5,"input",25),L(6,"language"),L(7,"async"),d(8,"select",26),E(9,Od,3,6,"option",27),f(),m(10,"textarea",28),L(11,"language"),L(12,"async"),m(13,"textarea",29),L(14,"language"),L(15,"async"),m(16,"textarea",30),L(17,"language"),L(18,"async"),m(19,"textarea",31),L(20,"language"),L(21,"async"),f()()),i&2){let t=_(2);g(),v("formGroup",t.editForm),g(),v("placeholder",A(4,11,A(3,9,"base"))),g(3),v("placeholder",A(7,15,A(6,13,"goal"))),g(3),v("value",t.card.type),g(),v("ngForOf",t.typeOptions),g(),v("placeholder",A(12,19,A(11,17,"goal"))+" sentence 1"),g(3),v("placeholder",A(15,23,A(14,21,"base"))+" sentence 1"),g(3),v("placeholder",A(18,27,A(17,25,"goal"))+" sentence 2"),g(3),v("placeholder",A(21,31,A(20,29,"base"))+" sentence 2")}}function Rd(i,e){if(i&1&&(d(0,"div")(1,"p",33),P(2),f(),d(3,"p",34),P(4),f(),d(5,"p",33),P(6),f(),d(7,"p",34),P(8),f()()),i&2){let t=_(2);g(2),pe(t.card.goal_sent_1),g(2),pe(t.card.base_sent_1),g(2),pe(t.card.goal_sent_2),g(2),pe(t.card.base_sent_2)}}function Fd(i,e){if(i&1){let t=N();d(0,"button",39),y("click",function(r){x(t);let s=_(3);return b(s.saveEdit(r))}),T(),d(1,"svg",16),m(2,"g",8)(3,"g",9),d(4,"g",10),m(5,"path",40),f()()()}if(i&2){let t=_(3);v("disabled",t.editForm.invalid)}}function Ld(i,e){if(i&1){let t=N();d(0,"button",6),y("click",function(r){x(t);let s=_(3);return b(s.delete(r))}),T(),d(1,"svg",41),m(2,"g",8)(3,"g",9),d(4,"g",10),m(5,"path",42),f()()()}}function Ad(i,e){if(i&1){let t=N();d(0,"div",3)(1,"button",6),y("click",function(r){x(t);let s=_(2);return b(s.menuClose(r))}),T(),d(2,"svg",35),m(3,"g",8)(4,"g",9),d(5,"g",10),m(6,"path",36),f()()(),E(7,Fd,6,1,"button",37)(8,Ld,6,0,"button",38),f()}if(i&2){let t=_(2);g(7),v("ngIf",t.showEdit&&t.editForm.valid),g(),v("ngIf",t.showEdit)}}function Dd(i,e){if(i&1){let t=N();d(0,"span"),y("@fadeIn.done",function(){x(t);let r=_();return b(r.fadeInState==="inactive"?r.revealCard():null)}),E(1,Nd,22,33,"div",0)(2,Rd,9,4,"div",0)(3,Ad,9,2,"div",22),f()}if(i&2){let t=_();Fe(t.flipped?"card-menu":"card-menu back"),v("@fadeIn",t.fadeInState),g(),v("ngIf",t.showEdit),g(),v("ngIf",t.showInfo),g(),v("ngIf",!t.showCard)}}var si=(()=>{let e=class e{constructor(n,r){this.cardService=n,this.setSelectService=r,this.onSwiped=new dt,this.onUpdated=new dt,this.onDeleted=new dt,this.touchStart=null,this.flipState="inactive",this.swipeRightState="inactive",this.swipeLeftState="inactive",this.fadeInState="inactive",this.flipped=!1,this.flipping=!1,this.showEdit=!1,this.showCard=!0,this.showInfo=!1,this.showDelete=!1}ngOnInit(){this.typeOptions=this.cardService.typeOptions,this.editForm=new Ge({base:new W(this.card.base,re.required),goal:new W(this.card.goal,re.required),type:new W(this.card.type,re.required),goal_sent_1:new W(this.card.goal_sent_1),base_sent_1:new W(this.card.base_sent_1),goal_sent_2:new W(this.card.goal_sent_2),base_sent_2:new W(this.card.base_sent_2)})}handleTouchStart(n){this.touchStart=n}handleTouchEnd(n){this.touchStart&&(this.showCard&&this.handleSwipe({start:this.touchStart,end:n}),this.touchStart=null)}handleKeyDown(n){this.showCard&&(n.key==="ArrowUp"||n.key==="ArrowDown"?this.tap():n.key==="ArrowRight"?this.swipeRight():n.key==="ArrowLeft"&&this.swipeLeft())}handleTouch(){this.tap()}handleSwipe(n){let r=n.end.changedTouches[0].pageX-n.start.changedTouches[0].pageX;Math.abs(r)>100&&(r>0?this.swipeRight():this.swipeLeft())}getFront(){return this.baseFront?this.card.base:this.card.goal}getBack(){return this.baseFront?this.card.goal:this.card.base}tap(){this.showCard&&(this.flipState=this.flipState==="inactive"?"active":"inactive")}menuClose(n){n.stopPropagation(),this.fade()}saveEdit(n){this.onUpdated.emit(Re(Re({},this.card),this.editForm.value)),this.menuClose(n)}delete(n){if(n.stopPropagation(),!this.showDelete){this.showDelete=!0;return}this.fade(),this.onDeleted.emit(this.card)}revealCard(){this.showEdit=!1,this.showCard=!0,this.showInfo=!1}editTapped(n){n.stopPropagation(),this.fade(),this.showEdit=!0,this.showCard=!1,this.showInfo=!1}starTapped(n,r){n.stopPropagation(),this.setSelectService.open(r.id)}infoTapped(n){n.stopPropagation(),this.fade(),this.showEdit=!1,this.showCard=!1,this.showInfo=!0}swipeRight(){this.swipeRightState=this.swipeRightState==="inactive"?"active":"inactive"}swipeLeft(){this.swipeLeftState=this.swipeLeftState==="inactive"?"active":"inactive"}fade(){this.fadeInState=this.fadeInState==="inactive"?"active":"inactive"}emitSwiped(n){n.fromState==="inactive"&&n.toState==="active"&&(n.triggerName==="swipeRight"?this.onSwiped.emit(!0):this.onSwiped.emit(!1))}};e.\u0275fac=function(r){return new(r||e)(M(Oe),M(Ft))},e.\u0275cmp=V({type:e,selectors:[["app-card"]],hostBindings:function(r,s){r&1&&y("touchstart",function(a){return s.handleTouchStart(a)},!1,pn)("touchend",function(a){return s.handleTouchEnd(a)},!1,pn)("keydown",function(a){return s.handleKeyDown(a)},!1,pn)},inputs:{card:"card",color:"color",baseFront:"baseFront"},outputs:{onSwiped:"onSwiped",onUpdated:"onUpdated",onDeleted:"onDeleted"},standalone:!0,features:[j],decls:5,vars:13,consts:[[4,"ngIf"],["id","container",3,"click"],[3,"class",4,"ngIf"],[1,"btn-row"],[1,"btn","submit",3,"click"],[1,"btn","cancel",3,"click"],[1,"icon-btn",3,"click"],["viewBox","0 0 1024 1024","xmlns","http://www.w3.org/2000/svg","fill","#000000"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["fill","#000000","d","M832 512a32 32 0 1 1 64 0v352a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h352a32 32 0 0 1 0 64H192v640h640V512z"],["fill","#000000","d","m469.952 554.24 52.8-7.552L847.104 222.4a32 32 0 1 0-45.248-45.248L477.44 501.44l-7.552 52.8zm422.4-422.4a96 96 0 0 1 0 135.808l-331.84 331.84a32 32 0 0 1-18.112 9.088L436.8 623.68a32 32 0 0 1-36.224-36.224l15.104-105.6a32 32 0 0 1 9.024-18.112l331.904-331.84a96 96 0 0 1 135.744 0z"],[1,"icon-btn","star",3,"click"],["fill","#ffff00","viewBox","0 0 1920 1920","xmlns","http://www.w3.org/2000/svg","stroke","#ffff00"],["fill","#000000","viewBox","0 0 1920 1920","xmlns","http://www.w3.org/2000/svg"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M12 17.75C12.4142 17.75 12.75 17.4142 12.75 17V11C12.75 10.5858 12.4142 10.25 12 10.25C11.5858 10.25 11.25 10.5858 11.25 11V17C11.25 17.4142 11.5858 17.75 12 17.75Z","fill","#000000"],["d","M12 7C12.5523 7 13 7.44772 13 8C13 8.55228 12.5523 9 12 9C11.4477 9 11 8.55228 11 8C11 7.44772 11.4477 7 12 7Z","fill","#000000"],["fill-rule","evenodd","clip-rule","evenodd","d","M1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12ZM12 2.75C6.89137 2.75 2.75 6.89137 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75Z","fill","#000000"],["d","M1915.918 737.475c-10.955-33.543-42.014-56.131-77.364-56.131h-612.029l-189.063-582.1v-.112C1026.394 65.588 995.335 43 959.984 43c-35.237 0-66.41 22.588-77.365 56.245L693.443 681.344H81.415c-35.35 0-66.41 22.588-77.365 56.131-10.955 33.544.79 70.137 29.478 91.03l495.247 359.831-189.177 582.212c-10.955 33.657 1.13 70.25 29.817 90.918 14.23 10.278 30.946 15.487 47.66 15.487 16.716 0 33.432-5.21 47.775-15.6l495.134-359.718 495.021 359.718c28.574 20.781 67.087 20.781 95.662.113 28.687-20.668 40.658-57.261 29.703-91.03l-189.176-582.1 495.36-359.83c28.574-20.894 40.433-57.487 29.364-91.03","fill-rule","evenodd"],["d","M1306.181 1110.407c-28.461 20.781-40.32 57.261-29.477 91.03l166.136 511.398-435.05-316.122c-28.686-20.781-67.086-20.781-95.66 0l-435.05 316.122 166.25-511.623c10.842-33.544-1.017-70.024-29.591-90.805L178.577 794.285h537.825c35.351 0 66.523-22.701 77.365-56.245l166.25-511.51 166.136 511.397a81.155 81.155 0 0 0 77.365 56.358h537.939l-435.276 316.122Zm609.77-372.819c-10.956-33.656-42.014-56.244-77.365-56.244h-612.141l-189.064-582.1C1026.426 65.589 995.367 43 960.017 43c-35.351 0-66.523 22.588-77.365 56.245L693.475 681.344H81.335c-35.351 0-66.41 22.588-77.366 56.244-10.842 33.657 1.017 70.137 29.591 90.918l495.247 359.718-189.29 582.211c-10.842 33.657 1.017 70.137 29.704 90.918 14.23 10.39 31.059 15.586 47.661 15.586 16.829 0 33.657-5.195 47.887-15.699l495.248-359.718 495.02 359.718c28.575 20.894 67.088 20.894 95.775.113 28.574-20.781 40.433-57.261 29.59-91.03l-189.289-582.1 495.247-359.717c28.687-20.781 40.546-57.261 29.59-90.918Z","fill-rule","evenodd"],["class","btn-row",4,"ngIf"],[1,"edit-form",3,"formGroup"],["type","text","formControlName","base",1,"border-input",3,"placeholder"],["type","text","formControlName","goal",1,"border-input",3,"placeholder"],["formControlName","type",1,"border-input",3,"value"],[3,"selected","background",4,"ngFor","ngForOf"],["type","text","formControlName","goal_sent_1",1,"border-input",3,"placeholder"],["type","text","formControlName","base_sent_1",1,"border-input",3,"placeholder"],["type","text","formControlName","goal_sent_2",1,"border-input",3,"placeholder"],["type","text","formControlName","base_sent_2",1,"border-input",3,"placeholder"],[3,"selected"],[1,"sent-ger"],[1,"sent-eng"],["fill","#000000","viewBox","0 0 1024 1024","xmlns","http://www.w3.org/2000/svg"],["d","M222.927 580.115l301.354 328.512c24.354 28.708 20.825 71.724-7.883 96.078s-71.724 20.825-96.078-7.883L19.576 559.963a67.846 67.846 0 01-13.784-20.022 68.03 68.03 0 01-5.977-29.488l.001-.063a68.343 68.343 0 017.265-29.134 68.28 68.28 0 011.384-2.6 67.59 67.59 0 0110.102-13.687L429.966 21.113c25.592-27.611 68.721-29.247 96.331-3.656s29.247 68.721 3.656 96.331L224.088 443.784h730.46c37.647 0 68.166 30.519 68.166 68.166s-30.519 68.166-68.166 68.166H222.927z"],["class","icon-btn",3,"disabled","click",4,"ngIf"],["class","icon-btn",3,"click",4,"ngIf"],[1,"icon-btn",3,"click","disabled"],["fill-rule","evenodd","clip-rule","evenodd","d","M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z","fill","#0F0F0F"],["viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg","fill","none"],["fill","#000000","fill-rule","evenodd","d","M7 1a2 2 0 00-2 2v2H2a1 1 0 000 2h.884c.036.338.078.754.12 1.213.11 1.202.218 2.664.218 3.787 0 1.47-.183 3.508-.315 4.776a2.015 2.015 0 002 2.224h10.186a2.015 2.015 0 002-2.224c-.132-1.268-.315-3.306-.315-4.776 0-1.123.107-2.585.218-3.787.042-.459.084-.875.12-1.213H18a1 1 0 100-2h-3V3a2 2 0 00-2-2H7zm6 4V3H7v2h6zM4.996 8.03c-.035-.378-.07-.728-.101-1.03h10.21a81.66 81.66 0 00-.1 1.03c-.112 1.212-.227 2.75-.227 3.97 0 1.584.194 3.714.325 4.982v.007a.02.02 0 01-.005.008l-.003.003H4.905a.024.024 0 01-.008-.01v-.008c.131-1.268.325-3.398.325-4.982 0-1.22-.115-2.758-.226-3.97zM8 8a1 1 0 011 1v6a1 1 0 11-2 0V9a1 1 0 011-1zm5 1a1 1 0 10-2 0v6a1 1 0 102 0V9z"]],template:function(r,s){r&1&&(E(0,Md,7,0,"app-modal",0),d(1,"div",1),y("click",function(){return s.handleTouch()})("@flip.start",function(){return s.flipping=!0})("@flip.done",function(){return s.flipped=!s.flipped,s.flipping=!1})("@swipeRight.done",function(a){return s.emitSwiped(a)})("@swipeLeft.done",function(a){return s.emitSwiped(a)}),E(2,Td,2,3,"div",2)(3,Id,19,3,"div",2)(4,Dd,4,6,"span",2),f()),r&2&&(v("ngIf",s.showDelete),g(),ce(ie(11,kd,s.color)),Fe(s.flipped?"card":"card back"),v("@flip",s.flipState)("@swipeRight",s.swipeRightState)("@swipeLeft",s.swipeLeftState),g(),v("ngIf",!s.flipping&&s.showCard),g(),v("ngIf",!s.flipping&&s.showCard),g(),v("ngIf",s.showEdit||s.showInfo))},dependencies:[X,Z,fe,_n,Be,ft,xn,bn,Ve,wn,je,pt,mt,_t,$e,ii,gt],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}[_nghost-%COMP%]{width:100%}.card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:center;height:100%;border-radius:10px;box-shadow:0 1px 2px gray;word-wrap:break-word;overflow-y:scroll}.card[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;height:100%;font-size:32px;padding:1rem}.back[_ngcontent-%COMP%]{transform:rotateY(180deg)}.star[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.filled[_ngcontent-%COMP%]{background:#ff0}.btn-row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;margin-bottom:.25rem}.card-menu[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;justify-content:space-between;margin:1rem 1rem 0}.edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;gap:.5rem}.sent-ger[_ngcontent-%COMP%]{font-size:30px;font-weight:400}.sent-eng[_ngcontent-%COMP%]{font-size:24px;font-weight:300}"],data:{animation:[ga,Ca,va,ya]}});let i=e;return i})();var Vd=i=>({width:i});function jd(i,e){i&1&&m(0,"app-loading")}function Gd(i,e){if(i&1){let t=N();d(0,"app-card",25),L(1,"typeColor"),y("onSwiped",function(r){x(t);let s=_(4);return b(s.handleSwiped(r))})("onUpdated",function(r){x(t);let s=_(4);return b(s.handleCardUpdated(r))})("onDeleted",function(r){x(t);let s=_(4);return b(s.handleCardDeleted(r))}),f()}if(i&2){let t=_().$implicit,n=_(3);v("card",t)("color",A(1,3,t.type))("baseFront",n.getbaseFront())}}function Bd(i,e){if(i&1&&(Hr(0),E(1,Gd,2,5,"app-card",24),Ur()),i&2){let t=e.index,n=_(3);g(),v("ngIf",t===n.deck.length-1)}}function Hd(i,e){if(i&1&&(d(0,"div",0),E(1,Bd,2,1,"ng-container",21),d(2,"div",22),m(3,"div",23),f()()),i&2){let t=_(2);g(),v("ngForOf",t.deck),g(2),ce(ie(3,Vd,t.deckProgress))}}function Ud(i,e){if(i&1){let t=N();d(0,"div",28)(1,"p"),P(2,"You're out of cards!"),f(),d(3,"button",29),y("click",function(){x(t);let r=_(3);return b(r.initAndDeal())}),P(4,"Reset card pile?"),f()()}}function Wd(i,e){if(i&1){let t=N();d(0,"button",29),y("click",function(){x(t);let r=_(3);return b(r.dealMissed())}),P(1),f()}if(i&2){let t=_(3);g(),ae("Deal ",t.missed.length," missed cards?")}}function zd(i,e){if(i&1){let t=N();d(0,"button",29),y("click",function(){x(t);let r=_(3);return b(r.dealSameDeck())}),P(1,"Deal same deck?"),f()}}function qd(i,e){if(i&1){let t=N();d(0,"button",29),y("click",function(){x(t);let r=_(3);return b(r.dealNewDeck())}),P(1),f()}if(i&2){let t=_(3);g(),ae("Deal another ",t.getDeckSize(),"?")}}function Yd(i,e){if(i&1&&(d(0,"div",1),E(1,Ud,5,0,"div",26)(2,Wd,2,1,"button",27)(3,zd,2,0,"button",27)(4,qd,2,1,"button",27),f()),i&2){let t=_(2);g(),v("ngIf",t.pile.length===0),g(),v("ngIf",t.missed.length>0),g(),v("ngIf",t.currentDeck.length>0),g(),v("ngIf",t.pile.length>0)}}function Kd(i,e){if(i&1){let t=N();E(0,Hd,4,5,"div",0)(1,Yd,5,4,"div",1),d(2,"app-navbar")(3,"button",2),y("click",function(){x(t);let r=_();return b(r.backPressed())}),T(),d(4,"svg",3),m(5,"g",4)(6,"g",5),d(7,"g",6),m(8,"path",7),f()()(),ee(),d(9,"button",8),y("click",function(){x(t);let r=_();return b(r.undoPressed())}),T(),d(10,"svg",9),m(11,"g",4)(12,"g",10),d(13,"g",6)(14,"title"),P(15,"undo"),f(),d(16,"g",11)(17,"g",12),m(18,"rect",13),f(),d(19,"g",14),m(20,"path",15),f()()()()(),ee(),d(21,"button",16),y("click",function(){x(t);let r=_();return b(r.addPressed())}),T(),d(22,"svg",17),m(23,"g",4)(24,"g",10),d(25,"g",6),m(26,"path",18)(27,"path",19),f()()(),ee(),d(28,"button",20),y("click",function(){x(t);let r=_();return b(r.redoPressed())}),T(),d(29,"svg",9),m(30,"g",4)(31,"g",10),d(32,"g",6)(33,"title"),P(34,"undo"),f(),d(35,"g",11)(36,"g",12),m(37,"rect",13),f(),d(38,"g",14),m(39,"path",15),f()()()()()()}if(i&2){let t=_();ne(t.deck.length>0?0:1)}}var Gr=(()=>{let e=class e{constructor(n,r,s,o,a,l,c,u){this.actionsService=n,this.route=r,this.cardService=s,this.menuService=o,this.notificationService=a,this.router=l,this.setsService=c,this.settingsService=u,this.loading=!1,this.subs=[],this.set=null,this.pile=[],this.deck=[],this.currentDeck=[],this.missed=[],this.deckProgress="0%"}ngOnInit(){this.loading=!0,this.settingsService.loading?this.settingsService.loaded.subscribe(()=>this.init()):this.init()}init(){return S(this,null,function*(){this.subs=[this.route.paramMap.subscribe(n=>this.loadCards(n)),this.actionsService.activeUndo.subscribe(n=>this.applyUndo(n)),this.actionsService.activeRedo.subscribe(n=>this.applyRedo(n)),this.settingsService.dealStarredChanged.subscribe(()=>this.initAndDeal()),this.cardService.cardAdded.subscribe(n=>{this.pile.push(n)})]})}loadCards(n){return S(this,null,function*(){this.set=yield this.setsService.loadSetFromParams(n),this.cardService.loadCards().then(()=>{this.initAndDeal(),this.loading=!1}).catch(()=>{this.notificationService.push({message:"Couldn't load cards!",success:!1})})})}initPile(){return S(this,null,function*(){if(this.set){this.pile=yield this.setsService.getCards(this.set.id);return}this.settingsService.getDealStarred()?this.pile=structuredClone(this.cardService.getStarred()):this.pile=structuredClone(this.cardService.getCards())})}initAndDeal(){this.initPile().then(()=>this.dealNewDeck())}applyUndo(n){n.direction||this.missed.splice(this.missed.findIndex(r=>r.id===n.card.id),1),this.deck.push(n.card),this.setDeckProgress()}applyRedo(n){this.handleSwiped(n.direction)}refreshWorkingCards(){let n=this.cardService.getCards();for(let r of[this.currentDeck,this.deck,this.missed])for(let s=0;s<r.length;s++){let o=this.cardService.findCardIndex(r[s].id);if(o===null)return;r[s]=n[o]}}removeFromWorkingCards(n){for(let r of[this.currentDeck,this.deck,this.missed])for(let s=0;s<r.length;s++)if(r[s].id===n){r.splice(s,1);break}}updateCard(n){let r=this.cardService.findCardIndex(n.id);r!==null&&this.cardService.update(n,r).then(()=>{this.notificationService.push({message:"Card updated!",success:!0}),this.refreshWorkingCards()}).catch(s=>{this.notificationService.push({message:"Card update failed! "+s,success:!1})})}deleteCard(n){let r=this.cardService.findCardIndex(n);r!==null&&this.cardService.delete(n,r).then(()=>{this.notificationService.push({message:"Card deleted!",success:!0}),this.actionsService.reset(),this.removeFromWorkingCards(n)}).catch(s=>{this.notificationService.push({message:"Failed to delete card! "+s,success:!1})})}getbaseFront(){return this.settingsService.getBaseFront()}getDeckSize(){return this.settingsService.getDeckSize()}shuffle(n){for(let r=n.length-1;r>0;r--){let s=Math.floor(Math.random()*(r+1));[n[r],n[s]]=[n[s],n[r]]}}deal(n){let r=[];for(let s=0;s<this.getDeckSize();s++){if(n.length===0)return r;let o=Math.floor(Math.random()*n.length);r.push(n[o]),n.splice(o,1)}return r}initDeck(){this.missed=[],this.actionsService.reset(),this.setDeckProgress()}dealMissed(){this.deck=this.missed,this.shuffle(this.deck),this.initDeck()}dealSameDeck(){this.deck=structuredClone(this.currentDeck),this.shuffle(this.deck),this.initDeck()}dealNewDeck(){this.deck=this.deal(this.pile),this.currentDeck=structuredClone(this.deck),this.initDeck()}handleSwiped(n){let r=this.deck.pop();r&&(this.actionsService.pushUndo({direction:n,card:r}),this.actionsService.resetRedos(),n||this.missed.push(r),this.setDeckProgress())}setDeckProgress(){let n=this.currentDeck.length;this.deckProgress=100*((1+Math.abs(this.deck.length-n))/n)+"%"}handleCardUpdated(n){this.updateCard(n)}handleCardDeleted(n){this.deleteCard(n.id)}backPressed(){this.router.navigateByUrl("")}undoPressed(){this.actionsService.applyUndo()}addPressed(){this.menuService.openAddCard()}redoPressed(){this.actionsService.applyRedo()}ngOnDestroy(){this.subs.forEach(n=>n.unsubscribe())}};e.\u0275fac=function(r){return new(r||e)(M(ri),M(gn),M(Oe),M(Ne),M(se),M(De),M(xe),M(Lt))},e.\u0275cmp=V({type:e,selectors:[["app-deck"]],standalone:!0,features:[j],decls:2,vars:1,consts:[[1,"deck"],[1,"options"],["title","Home",1,"icon-btn",3,"click"],["fill","#000000","viewBox","0 0 24 24","id","Layer_1","data-name","Layer 1","xmlns","http://www.w3.org/2000/svg","transform","matrix(1, 0, 0, 1, 0, 0)"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round","stroke","#CCCCCC","stroke-width","0.24000000000000005"],["id","SVGRepo_iconCarrier"],["d","M20.466,1.967,14.78.221a5.011,5.011,0,0,0-6.224,3.24L8.368,4H5A5.006,5.006,0,0,0,0,9V19a5.006,5.006,0,0,0,5,5h6a4.975,4.975,0,0,0,3.92-1.934,5.029,5.029,0,0,0,.689.052,4.976,4.976,0,0,0,4.775-3.563L23.8,8.156A5.021,5.021,0,0,0,20.466,1.967ZM11,22H5a3,3,0,0,1-3-3V9A3,3,0,0,1,5,6h6a3,3,0,0,1,3,3V19A3,3,0,0,1,11,22ZM21.887,7.563l-3.412,10.4a2.992,2.992,0,0,1-2.6,2.134A4.992,4.992,0,0,0,16,19V9a5.006,5.006,0,0,0-5-5h-.507a3,3,0,0,1,3.7-1.867l5.686,1.746A3.006,3.006,0,0,1,21.887,7.563ZM12,13c0,1.45-1.544,3.391-2.714,4.378a1.991,1.991,0,0,1-2.572,0C5.544,16.391,4,14.45,4,13a2,2,0,0,1,4,0,2,2,0,0,1,4,0Z"],["title","Undo",1,"icon-btn",3,"click"],["viewBox","0 0 48 48","xmlns","http://www.w3.org/2000/svg","fill","#000000"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","Layer_2","data-name","Layer 2"],["id","invisible_box","data-name","invisible box"],["width","48","height","48","fill","none"],["id","icons_Q2","data-name","icons Q2"],["d","M46,24A22,22,0,0,1,4.3,33.7a2,2,0,0,1,.5-2.6,2,2,0,0,1,3,.7A17.8,17.8,0,0,0,24,42,18,18,0,1,0,10.6,12h5.3A2.1,2.1,0,0,1,18,13.7,2,2,0,0,1,16,16H6a2,2,0,0,1-2-2V4.1A2.1,2.1,0,0,1,5.7,2,2,2,0,0,1,8,4V8.9A22,22,0,0,1,46,24Z"],["title","Add",1,"icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M11 8C11 7.44772 11.4477 7 12 7C12.5523 7 13 7.44772 13 8V11H16C16.5523 11 17 11.4477 17 12C17 12.5523 16.5523 13 16 13H13V16C13 16.5523 12.5523 17 12 17C11.4477 17 11 16.5523 11 16V13H8C7.44771 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11H11V8Z","fill","#0F0F0F"],["fill-rule","evenodd","clip-rule","evenodd","d","M23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12ZM3.00683 12C3.00683 16.9668 7.03321 20.9932 12 20.9932C16.9668 20.9932 20.9932 16.9668 20.9932 12C20.9932 7.03321 16.9668 3.00683 12 3.00683C7.03321 3.00683 3.00683 7.03321 3.00683 12Z","fill","#0F0F0F"],["title","Redo",1,"icon-btn",2,"transform","rotateY(180deg)",3,"click"],[4,"ngFor","ngForOf"],[1,"progress"],[1,"progress-inner"],[3,"card","color","baseFront","onSwiped","onUpdated","onDeleted",4,"ngIf"],[3,"onSwiped","onUpdated","onDeleted","card","color","baseFront"],["style","text-align: center;",4,"ngIf"],["class","btn",3,"click",4,"ngIf"],[2,"text-align","center"],[1,"btn",3,"click"]],template:function(r,s){r&1&&E(0,jd,1,0,"app-loading")(1,Kd,40,1,"app-navbar"),r&2&&ne(s.loading?0:1)},dependencies:[X,Z,fe,At,Qe,si,$e],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}[_nghost-%COMP%]{display:flex;flex-direction:column;margin:auto;width:100%;height:100%}.deck[_ngcontent-%COMP%]{height:100%;padding:1rem}.progress[_ngcontent-%COMP%]{width:100%;height:.25rem;background:#789;margin-top:.25rem;border-radius:2px}.progress-inner[_ngcontent-%COMP%]{height:100%;border-radius:2px;background:#7fffd4}.options[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:auto;gap:2rem}"]});let i=e;return i})();var $d=i=>({background:i});function Qd(i,e){i&1&&m(0,"app-loading")}function Zd(i,e){if(i&1){let t=N();d(0,"div",0)(1,"app-card",6),L(2,"typeColor"),y("onSwiped",function(){x(t);let r=_(2);return b(r.handleBack())})("onUpdated",function(r){x(t);let s=_(2);return b(s.handleUpdateCard(r))})("onDeleted",function(r){x(t);let s=_(2);return b(s.handleCardDeleted(r))}),f()()}if(i&2){let t=_(2);g(),v("card",t.expandedCard)("color",A(2,3,t.expandedCard.type))("baseFront",t.getBaseFront())}}function Xd(i,e){i&1&&(T(),d(0,"svg",12),m(1,"g",14)(2,"g",15),d(3,"g",16),m(4,"path",17),f()())}function Jd(i,e){i&1&&(T(),d(0,"svg",13),m(1,"g",14)(2,"g",15),d(3,"g",16),m(4,"path",18),f()())}function eu(i,e){if(i&1){let t=N();d(0,"div",8),L(1,"typeColor"),y("click",function(){let r=x(t).$implicit,s=_(3);return b(s.expandCard(r))}),d(2,"div",9)(3,"div",10),P(4),f(),d(5,"button",11),y("click",function(r){let s=x(t).$implicit,o=_(3);return b(o.openSetSelect(r,s))}),E(6,Xd,5,0,":svg:svg",12)(7,Jd,5,0,":svg:svg",13),f()()()}if(i&2){let t=e.$implicit,n=_(3);ce(ie(6,$d,A(1,4,t.type))),g(4),ae(" ",n.getBaseFront()?t.base:t.goal," "),g(2),ne(t.starred?6:7)}}function tu(i,e){if(i&1&&(d(0,"div",1),E(1,eu,8,8,"div",7),f()),i&2){let t=_(2);g(),v("ngForOf",t.results.slice(0,t.maxCards))}}function nu(i,e){if(i&1){let t=N();d(0,"button",19),y("click",function(){x(t);let r=_(2);return b(r.backPressed())}),T(),d(1,"svg",20),m(2,"g",14)(3,"g",15),d(4,"g",16),m(5,"path",21),f()()()}}function iu(i,e){if(i&1){let t=N();d(0,"button",22),y("click",function(){x(t);let r=_(2);return b(r.backPressed())}),T(),d(1,"svg",23),m(2,"g",14)(3,"g",24),d(4,"g",16),m(5,"path",25),f()()()}}function ru(i,e){if(i&1&&(E(0,Zd,3,5,"div",0)(1,tu,2,1,"div",1),d(2,"app-navbar"),E(3,nu,6,0,"button",2)(4,iu,6,0,"button",3),d(5,"div",4),m(6,"input",5),f()()),i&2){let t=_();ne(t.expandedCard&&t.expanded?0:1),g(3),ne(t.expanded&&t.expandedCard?3:4),g(3),v("formControl",t.query)}}var Br=(()=>{let e=class e{constructor(n,r,s,o,a,l,c){this.route=n,this.cardService=r,this.notificationService=s,this.router=o,this.setsService=a,this.settingsService=l,this.setSelectService=c,this.loading=!1,this.subs=[],this.maxCards=100,this.set=null,this.results=[],this.expanded=!1,this.expandedCard=null,this.query=new W("")}ngOnInit(){this.loading=!0,this.settingsService.loading?this.settingsService.loaded.subscribe(()=>this.init()):this.init()}init(){return S(this,null,function*(){yield this.cardService.loadCards().then(n=>{this.results=n,this.loading=!1}).catch(n=>alert("Failed to get cards from database! "+n)),this.subs=[this.route.paramMap.subscribe(n=>this.loadSet(n)),this.setsService.updated.subscribe(()=>{this.refreshSet()}),this.query.valueChanges.subscribe(n=>{this.set?this.filterSet(n):this.filterAll(n)})]})}loadSet(n){return S(this,null,function*(){this.set=yield this.setsService.loadSetFromParams(n),this.set&&(this.results=yield this.setsService.getCards(this.set.id)),this.loading=!1})}refreshSet(){return S(this,null,function*(){this.set&&(this.set&&(this.results=yield this.setsService.getCards(this.set.id)),this.filterSet(this.query.value))})}getBaseFront(){return this.settingsService.getBaseFront()}filterSet(n){return S(this,null,function*(){if(this.set===null)return;if(!n){this.results=yield this.setsService.getCards(this.set.id);return}let r=yield this.setsService.getCards(this.set.id);this.results=r.filter(s=>s.base.toLowerCase().includes(n.toLowerCase())||s.goal.toLowerCase().includes(n.toLowerCase()))})}filterAll(n){if(!n){this.results=this.cardService.getCards();return}this.results=this.cardService.getCards().filter(r=>r.base.toLowerCase().includes(n.toLowerCase())||r.goal.toLowerCase().includes(n.toLowerCase()))}openSetSelect(n,r){n.stopPropagation(),this.setSelectService.open(r.id)}expandCard(n){this.expanded=!0,this.expandedCard=n}updateResults(n){this.results.forEach((r,s)=>{if(r.id===n.id){this.results[s]=n;return}})}updateCard(n){let r=this.cardService.findCardIndex(n.id);r!==null&&this.cardService.update(n,r).then(()=>{this.updateResults(n),this.expandCard(n),this.notificationService.push({message:"Card updated!",success:!0})}).catch(s=>{this.notificationService.push({message:"Card update failed! "+s,success:!1})})}deleteCard(n){let r=this.cardService.findCardIndex(n);r!==null&&this.cardService.delete(n,r).then(()=>{this.notificationService.push({message:"Card deleted!",success:!0})}).catch(s=>{this.notificationService.push({message:"Failed to delete card! "+s,success:!1})})}backPressed(){if(!this.expanded&&this.expandedCard===null){this.router.navigateByUrl("");return}this.handleBack()}handleBack(){this.expanded=!1,this.expandedCard=null}handleUpdateCard(n){this.updateCard(n)}handleCardDeleted(n){this.deleteCard(n.id),this.handleBack()}ngOnDestroy(){this.subs.forEach(n=>n.unsubscribe())}};e.\u0275fac=function(r){return new(r||e)(M(gn),M(Oe),M(se),M(De),M(xe),M(Lt),M(Ft))},e.\u0275cmp=V({type:e,selectors:[["app-list"]],standalone:!0,features:[j],decls:2,vars:1,consts:[[1,"wrapper"],[1,"list"],["title","Back",1,"icon-btn"],["title","Home",1,"icon-btn"],[1,"search-container"],["type","text","placeholder","search...",1,"search",3,"formControl"],[2,"height","100%",3,"onSwiped","onUpdated","onDeleted","card","color","baseFront"],["class","list-card",3,"style","click",4,"ngFor","ngForOf"],[1,"list-card",3,"click"],[1,"row-between"],[1,"col-center",2,"max-width","75%"],[1,"icon-btn",2,"width","3rem","height","3rem",3,"click"],["fill","#ffff00","viewBox","0 0 1920 1920","xmlns","http://www.w3.org/2000/svg","stroke","#ffff00"],["fill","#000000","viewBox","0 0 1920 1920","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M1915.918 737.475c-10.955-33.543-42.014-56.131-77.364-56.131h-612.029l-189.063-582.1v-.112C1026.394 65.588 995.335 43 959.984 43c-35.237 0-66.41 22.588-77.365 56.245L693.443 681.344H81.415c-35.35 0-66.41 22.588-77.365 56.131-10.955 33.544.79 70.137 29.478 91.03l495.247 359.831-189.177 582.212c-10.955 33.657 1.13 70.25 29.817 90.918 14.23 10.278 30.946 15.487 47.66 15.487 16.716 0 33.432-5.21 47.775-15.6l495.134-359.718 495.021 359.718c28.574 20.781 67.087 20.781 95.662.113 28.687-20.668 40.658-57.261 29.703-91.03l-189.176-582.1 495.36-359.83c28.574-20.894 40.433-57.487 29.364-91.03","fill-rule","evenodd"],["d","M1306.181 1110.407c-28.461 20.781-40.32 57.261-29.477 91.03l166.136 511.398-435.05-316.122c-28.686-20.781-67.086-20.781-95.66 0l-435.05 316.122 166.25-511.623c10.842-33.544-1.017-70.024-29.591-90.805L178.577 794.285h537.825c35.351 0 66.523-22.701 77.365-56.245l166.25-511.51 166.136 511.397a81.155 81.155 0 0 0 77.365 56.358h537.939l-435.276 316.122Zm609.77-372.819c-10.956-33.656-42.014-56.244-77.365-56.244h-612.141l-189.064-582.1C1026.426 65.589 995.367 43 960.017 43c-35.351 0-66.523 22.588-77.365 56.245L693.475 681.344H81.335c-35.351 0-66.41 22.588-77.366 56.244-10.842 33.657 1.017 70.137 29.591 90.918l495.247 359.718-189.29 582.211c-10.842 33.657 1.017 70.137 29.704 90.918 14.23 10.39 31.059 15.586 47.661 15.586 16.829 0 33.657-5.195 47.887-15.699l495.248-359.718 495.02 359.718c28.575 20.894 67.088 20.894 95.775.113 28.574-20.781 40.433-57.261 29.59-91.03l-189.289-582.1 495.247-359.717c28.687-20.781 40.546-57.261 29.59-90.918Z","fill-rule","evenodd"],["title","Back",1,"icon-btn",3,"click"],["fill","#000000","viewBox","0 0 1024 1024","xmlns","http://www.w3.org/2000/svg"],["d","M222.927 580.115l301.354 328.512c24.354 28.708 20.825 71.724-7.883 96.078s-71.724 20.825-96.078-7.883L19.576 559.963a67.846 67.846 0 01-13.784-20.022 68.03 68.03 0 01-5.977-29.488l.001-.063a68.343 68.343 0 017.265-29.134 68.28 68.28 0 011.384-2.6 67.59 67.59 0 0110.102-13.687L429.966 21.113c25.592-27.611 68.721-29.247 96.331-3.656s29.247 68.721 3.656 96.331L224.088 443.784h730.46c37.647 0 68.166 30.519 68.166 68.166s-30.519 68.166-68.166 68.166H222.927z"],["title","Home",1,"icon-btn",3,"click"],["fill","#000000","viewBox","0 0 24 24","id","Layer_1","data-name","Layer 1","xmlns","http://www.w3.org/2000/svg","transform","matrix(1, 0, 0, 1, 0, 0)"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round","stroke","#CCCCCC","stroke-width","0.24000000000000005"],["d","M20.466,1.967,14.78.221a5.011,5.011,0,0,0-6.224,3.24L8.368,4H5A5.006,5.006,0,0,0,0,9V19a5.006,5.006,0,0,0,5,5h6a4.975,4.975,0,0,0,3.92-1.934,5.029,5.029,0,0,0,.689.052,4.976,4.976,0,0,0,4.775-3.563L23.8,8.156A5.021,5.021,0,0,0,20.466,1.967ZM11,22H5a3,3,0,0,1-3-3V9A3,3,0,0,1,5,6h6a3,3,0,0,1,3,3V19A3,3,0,0,1,11,22ZM21.887,7.563l-3.412,10.4a2.992,2.992,0,0,1-2.6,2.134A4.992,4.992,0,0,0,16,19V9a5.006,5.006,0,0,0-5-5h-.507a3,3,0,0,1,3.7-1.867l5.686,1.746A3.006,3.006,0,0,1,21.887,7.563ZM12,13c0,1.45-1.544,3.391-2.714,4.378a1.991,1.991,0,0,1-2.572,0C5.544,16.391,4,14.45,4,13a2,2,0,0,1,4,0,2,2,0,0,1,4,0Z"]],template:function(r,s){r&1&&E(0,Qd,1,0,"app-loading")(1,ru,7,3,"app-navbar"),r&2&&ne(s.loading?0:1)},dependencies:[X,Z,Be,Ve,je,fs,At,Qe,si,$e],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}[_nghost-%COMP%]{display:flex;flex-direction:column;margin:auto;width:100%;height:100%}.wrapper[_ngcontent-%COMP%]{height:100%;margin:1rem}.search-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}.search[_ngcontent-%COMP%]{border:4px solid black;border-radius:10px;background:none;outline:none;box-shadow:none}"]});let i=e;return i})();function su(i,e){if(i&1){let t=N();d(0,"app-color-choice",8),y("click",function(){let r=x(t).$implicit,s=_(2);return b(s.setForm.patchValue({color:r}))}),f()}if(i&2){let t,n=e.$implicit,r=_(2);v("value",n)("selected",((t=r.setForm.get("color"))==null?null:t.value)===n)}}function ou(i,e){if(i&1){let t=N();d(0,"button",9),y("click",function(){x(t);let r=_(3);return b(r.update())}),T(),d(1,"svg",10),m(2,"g",11)(3,"g",12),d(4,"g",13),m(5,"path",19),f()()()}}function au(i,e){if(i&1){let t=N();d(0,"button",9),y("click",function(){x(t);let r=_(2);return b(r.close())}),T(),d(1,"svg",10),m(2,"g",11)(3,"g",12),d(4,"g",13)(5,"g",14),m(6,"path",15),f()()()(),E(7,ou,6,0,"button",16),ee(),d(8,"button",9),y("click",function(){x(t);let r=_(2);return b(r.confirmOpen=!0)}),T(),d(9,"svg",17),m(10,"g",11)(11,"g",12),d(12,"g",13),m(13,"path",18),f()()()}if(i&2){let t=_(2);g(7),v("ngIf",t.setForm.valid)}}function lu(i,e){if(i&1){let t=N();d(0,"div",7)(1,"button",20),y("click",function(){x(t);let r=_(2);return b(r.delete())}),P(2,"yes"),f(),d(3,"div",21),P(4,"Delete set?"),f(),d(5,"button",22),y("click",function(){x(t);let r=_(2);return b(r.confirmOpen=!1)}),P(6,"no"),f()()}}function cu(i,e){if(i&1){let t=N();d(0,"app-modal",1),y("close",function(){x(t);let r=_();return b(r.close())}),d(1,"h3"),P(2),f(),d(3,"form",2),m(4,"input",3),d(5,"div",4),E(6,su,1,2,"app-color-choice",5),f()(),d(7,"div",6),E(8,au,14,1)(9,lu,7,0,"div",7),f()()}if(i&2){let t=_();g(2),ae("Edit ",t.set.name,""),g(),v("formGroup",t.setForm),g(3),v("ngForOf",t.getColorOptions()),g(2),ne(t.confirmOpen?9:8)}}var wa=(()=>{let e=class e{constructor(n){this.setsService=n,this.subs=[],this.confirmOpen=!1,this.set=null,this.setForm=new Ge({name:new W(null,re.required),color:new W(null,re.required)})}ngOnInit(){this.subs=[this.editing.subscribe(n=>this.initEditing(n))]}initEditing(n){this.set=n,this.setForm.patchValue({name:this.set?.name,color:this.set?.color})}getColorOptions(){return this.setsService.colorOptions}update(){if(!this.set)return;let n=this.setForm.value;this.setsService.updateSet(ct(Re({},this.set),{name:n.name?n.name:"",color:n.color?n.color:"lightgray"})).then(()=>this.close())}delete(){this.set&&this.setsService.deleteSet(this.set.id).then(()=>this.close())}close(){this.confirmOpen=!1,this.set=null,this.setForm.reset()}ngOnDestroy(){this.subs.forEach(n=>n.unsubscribe())}};e.\u0275fac=function(r){return new(r||e)(M(xe))},e.\u0275cmp=V({type:e,selectors:[["app-set-edit"]],inputs:{editing:"editing"},standalone:!0,features:[j],decls:1,vars:1,consts:[["class","container",3,"close",4,"ngIf"],[1,"container",3,"close"],[1,"add-form",3,"formGroup"],["type","text","formControlName","name","placeholder","Name",1,"border-input"],[1,"color-container"],[3,"value","selected","click",4,"ngFor","ngForOf"],[1,"row-between",2,"margin-top","1rem"],[1,"confirm-row"],[3,"click","value","selected"],[1,"icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["id","Menu / Close_LG"],["id","Vector","d","M21 21L12 12M12 12L3 3M12 12L21.0001 3M12 12L3 21.0001","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["class","icon-btn",3,"click",4,"ngIf"],["viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg","fill","none"],["fill","#000000","fill-rule","evenodd","d","M7 1a2 2 0 00-2 2v2H2a1 1 0 000 2h.884c.036.338.078.754.12 1.213.11 1.202.218 2.664.218 3.787 0 1.47-.183 3.508-.315 4.776a2.015 2.015 0 002 2.224h10.186a2.015 2.015 0 002-2.224c-.132-1.268-.315-3.306-.315-4.776 0-1.123.107-2.585.218-3.787.042-.459.084-.875.12-1.213H18a1 1 0 100-2h-3V3a2 2 0 00-2-2H7zm6 4V3H7v2h6zM4.996 8.03c-.035-.378-.07-.728-.101-1.03h10.21a81.66 81.66 0 00-.1 1.03c-.112 1.212-.227 2.75-.227 3.97 0 1.584.194 3.714.325 4.982v.007a.02.02 0 01-.005.008l-.003.003H4.905a.024.024 0 01-.008-.01v-.008c.131-1.268.325-3.398.325-4.982 0-1.22-.115-2.758-.226-3.97zM8 8a1 1 0 011 1v6a1 1 0 11-2 0V9a1 1 0 011-1zm5 1a1 1 0 10-2 0v6a1 1 0 102 0V9z"],["fill-rule","evenodd","clip-rule","evenodd","d","M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z","fill","#0F0F0F"],[1,"btn","submit",3,"click"],[1,"col-center"],[1,"btn","cancel",3,"click"]],template:function(r,s){r&1&&E(0,cu,10,4,"app-modal",0),r&2&&v("ngIf",s.set)},dependencies:[X,Z,fe,Be,ft,Ve,je,pt,mt,_t,gt,ti],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}.btn[_ngcontent-%COMP%]{margin:0}.confirm-row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;margin-bottom:1rem}"]});let i=e;return i})();var du=i=>({backgroundColor:i});function uu(i,e){i&1&&m(0,"app-loading")}function hu(i,e){if(i&1&&m(0,"app-set-edit",14),i&2){let t=_(2);v("editing",t.editing)}}function pu(i,e){if(i&1){let t=N();d(0,"div",15)(1,"div",16),y("click",function(){let r=x(t).$implicit,s=_(2);return b(s.navigateToList(r))}),d(2,"div",17),P(3),f(),d(4,"div",18)(5,"button",19),y("click",function(r){let s=x(t).$implicit,o=_(2);return b(o.edit(r,s))}),T(),d(6,"svg",10),m(7,"g",5)(8,"g",11),d(9,"g",7)(10,"g",20)(11,"g",21),m(12,"path",22)(13,"path",23),f()()()()(),ee(),d(14,"div",24),P(15),f(),d(16,"button",19),y("click",function(){let r=x(t).$implicit,s=_(2);return b(s.navigateToDeck(r))}),T(),d(17,"svg",10),m(18,"g",5)(19,"g",11),d(20,"g",7),m(21,"path",25),f()()()()()()}if(i&2){let t=e.$implicit;g(),ce(ie(5,du,t.color)),g(2),ae(" ",t.name," "),g(12),Wr(" ",t.cards.length," card",t.cards.length===1?"":"s"," ")}}function fu(i,e){if(i&1){let t=N();E(0,hu,1,1,"app-set-edit",0),d(1,"div",1),E(2,pu,22,7,"div",2),f(),d(3,"app-navbar")(4,"button",3),y("click",function(){x(t);let r=_();return b(r.backPressed())}),T(),d(5,"svg",4),m(6,"g",5)(7,"g",6),d(8,"g",7),m(9,"path",8),f()()(),ee(),d(10,"button",9),y("click",function(){x(t);let r=_();return b(r.addPressed())}),T(),d(11,"svg",10),m(12,"g",5)(13,"g",11),d(14,"g",7),m(15,"path",12)(16,"path",13),f()()()()}if(i&2){let t=_();v("ngIf",t.editing),g(2),v("ngForOf",t.sets)}}var xa=(()=>{let e=class e{constructor(n,r,s){this.menuService=n,this.router=r,this.setsService=s,this.loading=!1,this.sets=[],this.editing=new z}ngOnInit(){this.loading=!0,this.setsService.loadSets().then(n=>{this.sets=n,this.loading=!1})}navigateToList(n){this.router.navigateByUrl("/list/set/"+n.id)}navigateToDeck(n){this.router.navigateByUrl("/deck/set/"+n.id)}edit(n,r){n.stopPropagation(),this.editing.next(r)}backPressed(){this.router.navigateByUrl("")}addPressed(){this.menuService.openAddSet()}};e.\u0275fac=function(r){return new(r||e)(M(Ne),M(De),M(xe))},e.\u0275cmp=V({type:e,selectors:[["app-sets"]],standalone:!0,features:[j],decls:2,vars:1,consts:[[3,"editing",4,"ngIf"],[1,"grid"],["class","set",4,"ngFor","ngForOf"],["title","Home",1,"icon-btn",3,"click"],["fill","#000000","viewBox","0 0 24 24","id","Layer_1","data-name","Layer 1","xmlns","http://www.w3.org/2000/svg","transform","matrix(1, 0, 0, 1, 0, 0)"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round","stroke","#CCCCCC","stroke-width","0.24000000000000005"],["id","SVGRepo_iconCarrier"],["d","M20.466,1.967,14.78.221a5.011,5.011,0,0,0-6.224,3.24L8.368,4H5A5.006,5.006,0,0,0,0,9V19a5.006,5.006,0,0,0,5,5h6a4.975,4.975,0,0,0,3.92-1.934,5.029,5.029,0,0,0,.689.052,4.976,4.976,0,0,0,4.775-3.563L23.8,8.156A5.021,5.021,0,0,0,20.466,1.967ZM11,22H5a3,3,0,0,1-3-3V9A3,3,0,0,1,5,6h6a3,3,0,0,1,3,3V19A3,3,0,0,1,11,22ZM21.887,7.563l-3.412,10.4a2.992,2.992,0,0,1-2.6,2.134A4.992,4.992,0,0,0,16,19V9a5.006,5.006,0,0,0-5-5h-.507a3,3,0,0,1,3.7-1.867l5.686,1.746A3.006,3.006,0,0,1,21.887,7.563ZM12,13c0,1.45-1.544,3.391-2.714,4.378a1.991,1.991,0,0,1-2.572,0C5.544,16.391,4,14.45,4,13a2,2,0,0,1,4,0,2,2,0,0,1,4,0Z"],["title","Add",1,"icon-btn",3,"click"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["d","M11 8C11 7.44772 11.4477 7 12 7C12.5523 7 13 7.44772 13 8V11H16C16.5523 11 17 11.4477 17 12C17 12.5523 16.5523 13 16 13H13V16C13 16.5523 12.5523 17 12 17C11.4477 17 11 16.5523 11 16V13H8C7.44771 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11H11V8Z","fill","#0F0F0F"],["fill-rule","evenodd","clip-rule","evenodd","d","M23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12ZM3.00683 12C3.00683 16.9668 7.03321 20.9932 12 20.9932C16.9668 20.9932 20.9932 16.9668 20.9932 12C20.9932 7.03321 16.9668 3.00683 12 3.00683C7.03321 3.00683 3.00683 7.03321 3.00683 12Z","fill","#0F0F0F"],[3,"editing"],[1,"set"],[1,"set-card",3,"click"],[1,"set-title"],[1,"row-between"],[1,"icon-btn",3,"click"],["id","Interface / Settings"],["id","Vector"],["d","M20.3499 8.92293L19.9837 8.7192C19.9269 8.68756 19.8989 8.67169 19.8714 8.65524C19.5983 8.49165 19.3682 8.26564 19.2002 7.99523C19.1833 7.96802 19.1674 7.93949 19.1348 7.8831C19.1023 7.82677 19.0858 7.79823 19.0706 7.76998C18.92 7.48866 18.8385 7.17515 18.8336 6.85606C18.8331 6.82398 18.8332 6.79121 18.8343 6.72604L18.8415 6.30078C18.8529 5.62025 18.8587 5.27894 18.763 4.97262C18.6781 4.70053 18.536 4.44993 18.3462 4.23725C18.1317 3.99685 17.8347 3.82534 17.2402 3.48276L16.7464 3.1982C16.1536 2.85658 15.8571 2.68571 15.5423 2.62057C15.2639 2.56294 14.9765 2.56561 14.6991 2.62789C14.3859 2.69819 14.0931 2.87351 13.5079 3.22396L13.5045 3.22555L13.1507 3.43741C13.0948 3.47091 13.0665 3.48779 13.0384 3.50338C12.7601 3.6581 12.4495 3.74365 12.1312 3.75387C12.0992 3.7549 12.0665 3.7549 12.0013 3.7549C11.9365 3.7549 11.9024 3.7549 11.8704 3.75387C11.5515 3.74361 11.2402 3.65759 10.9615 3.50224C10.9334 3.48658 10.9056 3.46956 10.8496 3.4359L10.4935 3.22213C9.90422 2.86836 9.60915 2.69121 9.29427 2.62057C9.0157 2.55807 8.72737 2.55634 8.44791 2.61471C8.13236 2.68062 7.83577 2.85276 7.24258 3.19703L7.23994 3.1982L6.75228 3.48124L6.74688 3.48454C6.15904 3.82572 5.86441 3.99672 5.6517 4.23614C5.46294 4.4486 5.32185 4.69881 5.2374 4.97018C5.14194 5.27691 5.14703 5.61896 5.15853 6.3027L5.16568 6.72736C5.16676 6.79166 5.16864 6.82362 5.16817 6.85525C5.16343 7.17499 5.08086 7.48914 4.92974 7.77096C4.9148 7.79883 4.8987 7.8267 4.86654 7.88237C4.83436 7.93809 4.81877 7.96579 4.80209 7.99268C4.63336 8.26452 4.40214 8.49186 4.12733 8.65572C4.10015 8.67193 4.0715 8.68752 4.01521 8.71871L3.65365 8.91908C3.05208 9.25245 2.75137 9.41928 2.53256 9.65669C2.33898 9.86672 2.19275 10.1158 2.10349 10.3872C2.00259 10.6939 2.00267 11.0378 2.00424 11.7255L2.00551 12.2877C2.00706 12.9708 2.00919 13.3122 2.11032 13.6168C2.19979 13.8863 2.34495 14.134 2.53744 14.3427C2.75502 14.5787 3.05274 14.7445 3.64974 15.0766L4.00808 15.276C4.06907 15.3099 4.09976 15.3266 4.12917 15.3444C4.40148 15.5083 4.63089 15.735 4.79818 16.0053C4.81625 16.0345 4.8336 16.0648 4.8683 16.1255C4.90256 16.1853 4.92009 16.2152 4.93594 16.2452C5.08261 16.5229 5.16114 16.8315 5.16649 17.1455C5.16707 17.1794 5.16658 17.2137 5.16541 17.2827L5.15853 17.6902C5.14695 18.3763 5.1419 18.7197 5.23792 19.0273C5.32287 19.2994 5.46484 19.55 5.65463 19.7627C5.86915 20.0031 6.16655 20.1745 6.76107 20.5171L7.25478 20.8015C7.84763 21.1432 8.14395 21.3138 8.45869 21.379C8.73714 21.4366 9.02464 21.4344 9.30209 21.3721C9.61567 21.3017 9.90948 21.1258 10.4964 20.7743L10.8502 20.5625C10.9062 20.5289 10.9346 20.5121 10.9626 20.4965C11.2409 20.3418 11.5512 20.2558 11.8695 20.2456C11.9015 20.2446 11.9342 20.2446 11.9994 20.2446C12.0648 20.2446 12.0974 20.2446 12.1295 20.2456C12.4484 20.2559 12.7607 20.3422 13.0394 20.4975C13.0639 20.5112 13.0885 20.526 13.1316 20.5519L13.5078 20.7777C14.0971 21.1315 14.3916 21.3081 14.7065 21.3788C14.985 21.4413 15.2736 21.4438 15.5531 21.3855C15.8685 21.3196 16.1657 21.1471 16.7586 20.803L17.2536 20.5157C17.8418 20.1743 18.1367 20.0031 18.3495 19.7636C18.5383 19.5512 18.6796 19.3011 18.764 19.0297C18.8588 18.7252 18.8531 18.3858 18.8417 17.7119L18.8343 17.2724C18.8332 17.2081 18.8331 17.1761 18.8336 17.1445C18.8383 16.8247 18.9195 16.5104 19.0706 16.2286C19.0856 16.2007 19.1018 16.1726 19.1338 16.1171C19.166 16.0615 19.1827 16.0337 19.1994 16.0068C19.3681 15.7349 19.5995 15.5074 19.8744 15.3435C19.9012 15.3275 19.9289 15.3122 19.9838 15.2818L19.9857 15.2809L20.3472 15.0805C20.9488 14.7472 21.2501 14.5801 21.4689 14.3427C21.6625 14.1327 21.8085 13.8839 21.8978 13.6126C21.9981 13.3077 21.9973 12.9658 21.9958 12.2861L21.9945 11.7119C21.9929 11.0287 21.9921 10.6874 21.891 10.3828C21.8015 10.1133 21.6555 9.86561 21.463 9.65685C21.2457 9.42111 20.9475 9.25526 20.3517 8.92378L20.3499 8.92293Z","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M8.00033 12C8.00033 14.2091 9.79119 16 12.0003 16C14.2095 16 16.0003 14.2091 16.0003 12C16.0003 9.79082 14.2095 7.99996 12.0003 7.99996C9.79119 7.99996 8.00033 9.79082 8.00033 12Z","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"set-info","col-center"],["fill-rule","evenodd","clip-rule","evenodd","d","M5.46484 3.92349C4.79896 3.5739 4 4.05683 4 4.80888V19.1911C4 19.9432 4.79896 20.4261 5.46483 20.0765L19.1622 12.8854C19.8758 12.5108 19.8758 11.4892 19.1622 11.1146L5.46484 3.92349ZM2 4.80888C2 2.55271 4.3969 1.10395 6.39451 2.15269L20.0919 9.34382C22.2326 10.4677 22.2325 13.5324 20.0919 14.6562L6.3945 21.8473C4.39689 22.8961 2 21.4473 2 19.1911V4.80888Z","fill","#000000"]],template:function(r,s){r&1&&E(0,uu,1,0,"app-loading")(1,fu,17,2),r&2&&ne(s.loading?0:1)},dependencies:[X,Z,fe,At,Qe,wa],styles:["body[_ngcontent-%COMP%]{margin:0;background:#dedede;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{height:2.5rem;margin:0 .5rem;padding:.25rem;border:none;outline:none;border-radius:5px;background-color:#f0f8ff;font-size:large;font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}textarea[_ngcontent-%COMP%]{height:3.5rem}button[_ngcontent-%COMP%]{font-family:Gill Sans,Gill Sans MT,Calibri,Trebuchet MS,sans-serif}.label[_ngcontent-%COMP%]{font-size:20px}.btn[_ngcontent-%COMP%]{width:fit-content;margin:auto;padding:.5rem 1rem;border:none;outline:none;height:3rem;border-radius:5px;font-size:20px;box-shadow:0 1px 2px #d3d3d3}.submit[_ngcontent-%COMP%]{background-color:#90ee90}.cancel[_ngcontent-%COMP%]{background-color:#f08080}.icon-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;outline:none;border:none;background:none;width:4rem;height:4rem;padding:0 .5rem}.icon-btn[_ngcontent-%COMP%]:hover{cursor:pointer;outline:solid 1px black}.navbar[_ngcontent-%COMP%]{height:4rem;width:100%;display:flex;flex-direction:row;justify-content:space-between}.border-input[_ngcontent-%COMP%]{background:#ffffff10;border:solid 1px black}.list[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:1rem;gap:.5rem}.list-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:10px;box-shadow:0 1px 2px gray;font-size:32px;padding:1rem;gap:.5rem}.col-center[_ngcontent-%COMP%]{height:auto;display:flex;flex-direction:column;justify-content:center}.row-between[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.color-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;gap:.5rem;margin:1rem auto}[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;margin:auto;width:100%;height:100%}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.grid[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:repeat(4,1fr);grid-auto-rows:1fr;overflow-x:hidden;overflow-y:auto}.set[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.set-card[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:space-between;text-align:left;border-radius:4px;box-shadow:0 1px 2px gray;font-size:32px;gap:.5rem;margin:.5rem;padding:1rem .25rem}.set-title[_ngcontent-%COMP%]{margin:0 .5rem;word-break:normal;text-align:center}.set-info[_ngcontent-%COMP%]{font-size:26px;text-align:center}@media (max-width: 1500px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-width: 800px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 525px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(1,1fr)}}"]});let i=e;return i})();var vp=[{path:"",component:ma,canActivate:[me],children:[{path:"",component:_a,canActivate:[me]},{path:"deck",component:Gr,canActivate:[me]},{path:"deck/set/:setId",component:Gr,pathMatch:"full",canActivate:[me]},{path:"list",component:Br,canActivate:[me]},{path:"list/set/:setId",component:Br,pathMatch:"full",canActivate:[me]},{path:"sets",component:xa,canActivate:[me]}]}];export{vp as routes};
